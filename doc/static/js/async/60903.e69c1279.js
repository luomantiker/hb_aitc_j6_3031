"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["60903"],{45009:function(n,e,s){s.r(e);var i=s(85893),r=s(50065),o=s(95895);function l(n){let e=Object.assign({h1:"h1",a:"a",p:"p",code:"code",h2:"h2",pre:"pre",span:"span",h3:"h3"},(0,r.ah)(),n.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.h1,{id:"stereonet-binocular-depth-estimation-model-training",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#stereonet-binocular-depth-estimation-model-training",children:"#"}),"StereoNet Binocular Depth Estimation Model Training"]}),"\n",(0,i.jsx)(o.Z,{}),"\n",(0,i.jsxs)(e.p,{children:["This tutorial mainly shows you how to use HAT to train a ",(0,i.jsx)(e.code,{children:"StereoNet"})," model from scratch on the dataset ",(0,i.jsx)(e.code,{children:"SceneFlow"}),", including floating-point, quantized, and fixed-point models."]}),"\n",(0,i.jsxs)(e.h2,{id:"dataset-preparation",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#dataset-preparation",children:"#"}),"Dataset Preparation"]}),"\n",(0,i.jsxs)(e.p,{children:["Before starting to train the model, the first step is to prepare the dataset, which can be downloaded in the ",(0,i.jsx)(e.a,{href:"https://lmb.informatik.uni-freiburg.de/resources/datasets/SceneFlowDatasets.en.html",target:"_blank",rel:"noopener noreferrer",children:"SceneFlow dataset"})," .\r\nAt the same time, you need to prepare the list of files corresponding to the training data and validation dataset, and you can download ",(0,i.jsx)(e.code,{children:"SceneFlow_finalpass_train.txt"})," and ",(0,i.jsx)(e.code,{children:"SceneFlow_finalpass_test.txt"})," from ",(0,i.jsx)(e.a,{href:"https://github.com/haofeixu/aanet/tree/master/filenames",target:"_blank",rel:"noopener noreferrer",children:"here"})," ."]}),"\n",(0,i.jsx)(e.p,{children:"After downloading, unzip and organize the folder structure as follows:"}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-text",meta:"",children:[(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  |-- SceneFlow"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      |-- Driving"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          |-- disparity"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          |-- frames_finalpass"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      |-- FlyingThings3D"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          |-- disparity"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          |-- frames_finalpass"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      |-- Monkaa"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          |-- disparity"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          |-- frames_finalpass"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      |-- SceneFlow_finalpass_test.txt"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      |-- SceneFlow_finalpass_train.txt"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"}})})]})})}),"\n",(0,i.jsx)(e.p,{children:"In order to improve the speed of training, we made a package of data information files and converted them into a dataset in LMDB format.\r\nJust run the script below to successfully achieve the conversion:"}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"python3 tools"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"datasets"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sceneflow_packer"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"py --src"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" $"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"}"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" --split"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"name train --pack"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lmdb  --num"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"workers "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"10"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" --target"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" $"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"target"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"}"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"python3 tools"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"datasets"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"sceneflow_packer"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"py --src"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" $"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"}"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" --split"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"name test --pack"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lmdb  --num"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"workers "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"10"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" --target"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" $"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"target"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dir"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"}"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.p,{children:["The above two commands correspond to the transformation training dataset and the validation dataset respectively, after packaging, the file structure in the ",(0,i.jsx)(e.code,{children:"${target-data-dir}"})," directory should be as follows:"]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-text",meta:"",children:[(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"${target-data-dir}"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  |-- train_lmdb"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  |-- test_lmdb"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"}})})]})})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"train_lmdb"})," and ",(0,i.jsx)(e.code,{children:"test_lmdb"})," are packaged training datasets and validation datasets, and then you can start training the model."]}),"\n",(0,i.jsxs)(e.h3,{id:"model-training",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#model-training",children:"#"}),"Model Training"]}),"\n",(0,i.jsx)(e.p,{children:"Before the network starts training, you can use the following command to calculate the amount of computation and the number of parameters for the network:"}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/calops.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsx)(e.p,{children:"The next step is to start training.\r\nTraining can also be done through the following script, and you need to confirm whether the dataset path in the configuration has been switched to the packaged dataset path before training."}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/train.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"float"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/train.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"calibration"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/train.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"qat"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.p,{children:["Since the HAT algorithm package uses the registration mechanism, it allows each training task to be started in the form of ",(0,i.jsx)(e.code,{children:"train.py"})," plus a ",(0,i.jsx)(e.code,{children:"config"})," file.\r\nThe ",(0,i.jsx)(e.code,{children:"train.py"})," is a uniform training script and independent of the task, and the tasks we need to train, the datasets we need to use, and the hyperparameter settings related to training are all in the specified ",(0,i.jsx)(e.code,{children:"config"})," file."]}),"\n",(0,i.jsxs)(e.p,{children:["The parameters after ",(0,i.jsx)(e.code,{children:"--stage"})," in the above command can be ",(0,i.jsx)(e.code,{children:'"float"'}),", ",(0,i.jsx)(e.code,{children:'"calibration"'}),", ",(0,i.jsx)(e.code,{children:'"qat"'}),", which, respectively, indicates the training of the floating-point model and the quantitative model,\r\nand the conversion of the quantitative model to the fixed-point model, where the training of the quantitative model depends on the floating-point model produced by the previous floating-point training."]}),"\n",(0,i.jsxs)(e.h3,{id:"export-fixedpoint-model",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#export-fixedpoint-model",children:"#"}),"Export FixedPoint Model"]}),"\n",(0,i.jsx)(e.p,{children:"Once you've completed your quantization training, you can start exporting your fixed-point model. You can export it with the following command:"}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/export_hbir.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.h3,{id:"model-verification",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#model-verification",children:"#"}),"Model Verification"]}),"\n",(0,i.jsxs)(e.p,{children:["After completing the training, we get the trained floating-point, quantitative, or fixed-point model. Similar to the training method, we can use the same method to complete metrics validation on the trained model and get the metrics of ",(0,i.jsx)(e.code,{children:"Float"}),", ",(0,i.jsx)(e.code,{children:"Calibration"}),", ",(0,i.jsx)(e.code,{children:"QAT"}),",\r\nand ",(0,i.jsx)(e.code,{children:"Quantized"}),", which are floating-point, quantitative, and fully fixed-point metrics, respectively."]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/predict.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"float"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/predict.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"calibration"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/predict.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"qat"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.p,{children:["Similar to the model training, we can use ",(0,i.jsx)(e.code,{children:"--stage"})," followed by ",(0,i.jsx)(e.code,{children:'"float"'}),", ",(0,i.jsx)(e.code,{children:'"calibration"'}),", ",(0,i.jsx)(e.code,{children:'"qat"'}),", to validate the trained floating-point model, quantitative model, respectively."]}),"\n",(0,i.jsx)(e.p,{children:"The following command can be used to verify the accuracy of a fixed-point model, but it should be noted that hbir must be exported first:"}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/predict.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"int_infer"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.h3,{id:"model-inference",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#model-inference",children:"#"}),"Model Inference"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"HAT"})," provides the ",(0,i.jsx)(e.code,{children:"infer_hbir.py"})," script to visualize the inference results for the fixed-point model:"]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/infer_hbir.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--model-inputs"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ${model_inputs} "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--save-path"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ${save_path} "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--use-dataset"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/infer_hbir.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--model-inputs"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ${model_inputs} "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--save-path"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ${save_path}"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.h3,{id:"simulation-board-accuracy-verification",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#simulation-board-accuracy-verification",children:"#"}),"Simulation Board Accuracy Verification"]}),"\n",(0,i.jsx)(e.p,{children:"In addition to the above model validation, we provide an accuracy validation method identical to the on-board environment, which can be accomplished by:"}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/validation_hbir.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--stage"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"align_bpu"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.h3,{id:"fixed-point-model-checking-and-compilation",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#fixed-point-model-checking-and-compilation",children:"#"}),"Fixed-point Model Checking and Compilation"]}),"\n",(0,i.jsx)(e.p,{children:"As the quantitative training toolchain integrated in HAT is mainly prepared for Horizon's processors, it is a must to check and compile the quantitative models."}),"\n",(0,i.jsxs)(e.p,{children:["We provide an interface for model checking in HAT, which allows you to define a quantitative model and then check whether it can work properly on the ",(0,i.jsx)(e.code,{children:"BPU"})," first."]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/model_checker.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.p,{children:["After the model is trained, you can use the ",(0,i.jsx)(e.code,{children:"compile_perf_hbir"})," script to compile the quantitative model into an ",(0,i.jsx)(e.code,{children:"HBM"})," file that supports on-board running. The tool can also predict the performance on the ",(0,i.jsx)(e.code,{children:"BPU"}),"."]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"tools/compile_perf_hbir.py"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})]}),"\n"]})})}),"\n",(0,i.jsx)(e.p,{children:"The above is the whole process from data preparation to the generation of quantitative and deployable models."}),"\n",(0,i.jsxs)(e.h2,{id:"training-details",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#training-details",children:"#"}),"Training Details"]}),"\n",(0,i.jsxs)(e.p,{children:["In this note, we explain some things that need to be considered for model training, mainly including settings related to ",(0,i.jsx)(e.code,{children:"config"}),"."]}),"\n",(0,i.jsxs)(e.h3,{id:"model-construction",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#model-construction",children:"#"}),"Model Construction"]}),"\n",(0,i.jsxs)(e.p,{children:["The network structure of ",(0,i.jsx)(e.code,{children:"StereoNet"})," can be found in the ",(0,i.jsx)(e.a,{href:"https://arxiv.org/pdf/1807.08865.pdf",target:"_blank",rel:"noopener noreferrer",children:"Paper"}),", which is not described in detail here."]}),"\n",(0,i.jsxs)(e.p,{children:["We can easily define and modify the model by defining a ",(0,i.jsx)(e.code,{children:"dict"})," type variable like ",(0,i.jsx)(e.code,{children:"model"})," in the ",(0,i.jsx)(e.code,{children:"config"})," file."]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" nn"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"loss_weights "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ["}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.3"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.5"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.5"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1.0"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"]"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"maxdisp "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"192"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"use_bn "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"bias "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"bn_kwargs "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{}"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"refine_levels "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"4"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"out_channels "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ["}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"32"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"32"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"64"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"16"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"]"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"model "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"StereoNet"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    backbone"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"StereoNetNeck"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        out_channels"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"out_channels,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        use_bn"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"use_bn,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        bias"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"bias,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        bn_kwargs"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"bn_kwargs,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        act_type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"nn."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ReLU"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(),"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    head"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"StereoNetHead"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        maxdisp"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"maxdisp,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        bn_kwargs"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"bn_kwargs,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        refine_levels"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"refine_levels,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    post_process"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"StereoNetPostProcess"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        maxdisp"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"maxdisp,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    loss"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SmoothL1Loss"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"),"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    loss_weights"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"loss_weights,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,i.jsxs)(e.p,{children:["In addition to the ",(0,i.jsx)(e.code,{children:"backbone"}),", the model also has ",(0,i.jsx)(e.code,{children:"head"}),", ",(0,i.jsx)(e.code,{children:"post_process"}),", ",(0,i.jsx)(e.code,{children:"losses"})," modules.\r\nAmong them, ",(0,i.jsx)(e.code,{children:"backbone"})," is mainly to extract the features of the image, and ",(0,i.jsx)(e.code,{children:"head"})," is mainly used by the features to obtain the predicted parallax value.\r\nThe ",(0,i.jsx)(e.code,{children:"post_process"})," is mainly the post-processing part, and the ",(0,i.jsx)(e.code,{children:"losses"})," module uses the ",(0,i.jsx)(e.code,{children:"SmoothL1Loss"})," in the paper as the training ",(0,i.jsx)(e.code,{children:"loss"}),", and the ",(0,i.jsx)(e.code,{children:"loss_weights"})," is the weight of the corresponding ",(0,i.jsx)(e.code,{children:"loss"}),"."]}),"\n",(0,i.jsxs)(e.h3,{id:"data-enhancement",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#data-enhancement",children:"#"}),"Data Enhancement"]}),"\n",(0,i.jsxs)(e.p,{children:["Like the definition of ",(0,i.jsx)(e.code,{children:"model"}),", the data enhancement process is implemented by defining ",(0,i.jsx)(e.code,{children:"data_loader"})," and ",(0,i.jsx)(e.code,{children:"val_data_loader"})," in the ",(0,i.jsx)(e.code,{children:"config"})," file, which correspond to the processing of the training sets and verification sets, respectively.\r\nTaking ",(0,i.jsx)(e.code,{children:"data_loader"})," as an example, the data enhancement uses ",(0,i.jsx)(e.code,{children:"RandomCrop"}),", ",(0,i.jsx)(e.code,{children:"ToTensor"}),", and ",(0,i.jsx)(e.code,{children:"Normalize"})," to increase the diversity of training data and enhance the generalization ability of the model."]}),"\n",(0,i.jsxs)(e.p,{children:["Since the final model running on ",(0,i.jsx)(e.code,{children:"BPU"})," uses a ",(0,i.jsx)(e.code,{children:"YUV444"})," image input, and the general training image input is in the ",(0,i.jsx)(e.code,{children:"RGB"})," format, HAT provides ",(0,i.jsx)(e.code,{children:"BgrToYuv444"})," data enhancement to convert ",(0,i.jsx)(e.code,{children:"RGB"})," to ",(0,i.jsx)(e.code,{children:"YUV444"}),"."]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"data_loader "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"torch.utils.data.DataLoader,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    dataset"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SceneFlow"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        data_path"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"./tmp_data/SceneFlow/train_lmdb"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        transforms"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"["})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"RandomCrop"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                size"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"256"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"512"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"),"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"ToTensor"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                to_yuv"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                use_yuv_v2"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"BgrToYuv444"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", rgb_input"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"),"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"TorchVisionAdapter"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                interface"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Normalize"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                mean"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128.0"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                std"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128.0"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            ),"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        ],"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    sampler"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"torch.utils.data.DistributedSampler),"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    batch_size"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"train_batch_size_per_gpu,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    pin_memory"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    shuffle"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    num_workers"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"data_num_workers,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    collate_fn"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"collate_2d,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,i.jsxs)(e.p,{children:["A ",(0,i.jsx)(e.code,{children:"loss_collector"})," function is passed in ",(0,i.jsx)(e.code,{children:"batch_processor"})," to get the ",(0,i.jsx)(e.code,{children:"loss"})," for the current batch data, as follows:"]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"loss_collector"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"outputs"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"):"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" outputs"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"["}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"losses"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"]"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"batch_processor "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"MultiBatchProcessor"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    need_grad_update"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    loss_collector"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"loss_collector,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,i.jsx)(e.p,{children:"The data transformation of the validation set is relatively simpler, as follows:"}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"val_data_loader "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"torch.utils.data.DataLoader,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    dataset"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"SceneFlow"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        data_path"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"./tmp_data/SceneFlow/test_lmdb"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        transforms"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"["})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"ToTensor"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                to_yuv"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                use_yuv_v2"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"BgrToYuv444"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", rgb_input"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"),"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"TorchVisionAdapter"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                interface"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Normalize"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                mean"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128.0"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"                std"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128.0"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            ),"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        ],"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    sampler"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"torch.utils.data.DistributedSampler),"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    batch_size"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"test_batch_size_per_gpu,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    pin_memory"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    shuffle"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    num_workers"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"data_num_workers,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    collate_fn"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"collate_2d,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"val_batch_processor "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"MultiBatchProcessor"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    need_grad_update"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    loss_collector"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"None"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,i.jsxs)(e.h3,{id:"training-strategy",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#training-strategy",children:"#"}),"Training Strategy"]}),"\n",(0,i.jsxs)(e.p,{children:["Training a floating-point model on the ",(0,i.jsx)(e.code,{children:"SceneFlow"})," dataset uses the learning strategy of ",(0,i.jsx)(e.code,{children:"Cosine"})," with ",(0,i.jsx)(e.code,{children:"Warmup"}),", and impose L2 norm on the ",(0,i.jsx)(e.code,{children:"weight"})," parameter."]}),"\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"float_trainer"}),", ",(0,i.jsx)(e.code,{children:"calibration_trainer"}),", ",(0,i.jsx)(e.code,{children:"qat_trainer"}),", and ",(0,i.jsx)(e.code,{children:"int_trainer"})," in the ",(0,i.jsx)(e.code,{children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})," file correspond to the training strategies for floating-point, quantitative, and fixed-point models, respectively."]}),"\n",(0,i.jsxs)(e.p,{children:["The following is an example of ",(0,i.jsx)(e.code,{children:"float_trainer"})," training strategy:"]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"float_trainer "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"distributed_data_parallel_trainer"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    model"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"model,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    data_loader"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"data_loader,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    optimizer"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"torch.optim.Adam,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        params"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"weight"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:": "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(weight_decay"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"4e-5"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")},"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        lr"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"base_lr,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    batch_processor"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"train_batch_processor,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    stop_by"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"epoch"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    num_epochs"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"num_epochs,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    device"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"None"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    sync_bn"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    callbacks"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"["})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        stat_callback,"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        loss_show_callback,"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"CosLrUpdater"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            warmup_by"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"epoch"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            warmup_len"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"10"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            step_log_interval"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1000"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        ),"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        val_callback,"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        ckpt_callback,"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ],"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    train_metrics"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"["})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"LossShow"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"),"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"EndPointError"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            use_mask"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        ),"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ],"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    val_metrics"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"["})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            type"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"EndPointError"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            use_mask"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        ),"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ],"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,i.jsxs)(e.h3,{id:"quantization-training",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#quantization-training",children:"#"}),"Quantization Training"]}),"\n",(0,i.jsxs)(e.p,{children:["For key steps in quantitative training, such as preparing the floating-point model, operator substitution, inserting quantization and inverse quantization nodes, setting quantitative parameters, and operator fusion,\r\nplease read the ",(0,i.jsx)(e.a,{href:"/3.0.22/en/guide/plugin/introduce.html",children:"Quantized Awareness Training (QAT)"})," section.\r\nHere we focus on how to define and use the quantization models in binocular depth estimation of HAT."]}),"\n",(0,i.jsx)(e.p,{children:"If the model is ready, and some existing modules are quantized, HAT uses the following script in the training script to map the floating-point model to the fixed-point model uniformly."}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"model"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fuse_model"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"model"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"set_qconfig"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"horizon"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"prepare_qat"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(model, inplace"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n"]})})}),"\n",(0,i.jsxs)(e.p,{children:["The overall strategy of quantitative training can directly follow the strategy of floating-point training, but the learning rate and training length need to be adjusted appropriately.\r\nDue to the existence of the floating-point pre-training model, the learning rate ",(0,i.jsx)(e.code,{children:"Lr"})," for quantitative training can be very small.\r\nGenerally, you can start from 0.001 or 0.0001, and you can do one or two times ",(0,i.jsx)(e.code,{children:"Lr"})," adjustments of ",(0,i.jsx)(e.code,{children:"scale=0.1"})," with ",(0,i.jsx)(e.code,{children:"StepLrUpdater"})," without prolonging the training time.\r\nIn addition, ",(0,i.jsx)(e.code,{children:"weight decay"})," will also have some effect on the training results."]}),"\n",(0,i.jsxs)(e.p,{children:["The quantitative training strategy for the ",(0,i.jsx)(e.code,{children:"StereoNet"})," example model can be found in the ",(0,i.jsx)(e.code,{children:"configs/disparity_pred/stereonet/stereonet_stereonetneck_sceneflow.py"})," file."]})]})}function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,r.ah)(),n.components);return e?(0,i.jsx)(e,Object.assign({},n,{children:(0,i.jsx)(l,n)})):l(n)}e.default=t,t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["3.0.22%2Fen%2Fguide%2Fadvanced_content%2Fhat%2Fexamples%2Fstereonet.mdx"]={toc:[{id:"dataset-preparation",text:"Dataset Preparation",depth:2},{id:"model-training",text:"Model Training",depth:3},{id:"export-fixedpoint-model",text:"Export FixedPoint Model",depth:3},{id:"model-verification",text:"Model Verification",depth:3},{id:"model-inference",text:"Model Inference",depth:3},{id:"simulation-board-accuracy-verification",text:"Simulation Board Accuracy Verification",depth:3},{id:"fixed-point-model-checking-and-compilation",text:"Fixed-point Model Checking and Compilation",depth:3},{id:"training-details",text:"Training Details",depth:2},{id:"model-construction",text:"Model Construction",depth:3},{id:"data-enhancement",text:"Data Enhancement",depth:3},{id:"training-strategy",text:"Training Strategy",depth:3},{id:"quantization-training",text:"Quantization Training",depth:3}],title:"StereoNet Binocular Depth Estimation Model Training",frontmatter:{}}},95895:function(n,e,s){s(39710);var i=s(85893),r=s(67294),o=s(45687);s(20388);let l={"zh-CN":n=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${n.minutes>=1?`${Math.ceil(n.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":n=>`Estimated reading time: ${n.minutes>=1?`${Math.ceil(n.minutes)} minutes`:"less than 1 minute"}`};function t(n,e,s){let i=Object.keys(l).includes(e)?e:s;return l[i](n)}e.Z=n=>{let{defaultLocale:e="en-US"}=n,s=(0,o.Vi)().page.readingTimeData,l=(0,o.Jr)(),a=(0,o.e7)(),[c,h]=(0,r.useState)(t(s,l,e));return(0,r.useEffect)(()=>{h(t(s,l,e))},[l,s]),(0,i.jsx)("span",{"data-dark":String(a),className:"rp-reading-time",children:c})}}}]);