"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["99180"],{80171:function(e,s,n){n.r(s);var i=n(85893),a=n(50065),r=n(95895);function t(e){let s=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",code:"code",ul:"ul",li:"li",span:"span",math:"math",semantics:"semantics",mrow:"mrow",msubsup:"msubsup",mo:"mo",mi:"mi",mn:"mn",annotation:"annotation",h3:"h3",div:"div"},(0,a.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.h1,{id:"alignment-rule",children:[(0,i.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#alignment-rule",children:"#"}),"Alignment Rule"]}),"\n",(0,i.jsx)(r.Z,{}),"\n",(0,i.jsx)(s.p,{children:"This section describes the alignment restriction rules when using BPU."}),"\n",(0,i.jsxs)(s.h2,{id:"model-input-requirement",children:[(0,i.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#model-input-requirement",children:"#"}),"Model Input Requirement"]}),"\n",(0,i.jsx)(s.p,{children:"BPU does not restrict the model input size or parity. Both 416x416 inputs (e.g., YOLO) and 227x227 inputs (e.g., SqueezeNet) can be supported."}),"\n",(0,i.jsx)(s.p,{children:"For NV12, Both H & W of the input are required to be even to meet the requirement that the UV is half of the Y."}),"\n",(0,i.jsxs)(s.h2,{id:"alignment-and-efficient-data",children:[(0,i.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#alignment-and-efficient-data",children:"#"}),"Alignment and Efficient Data"]}),"\n",(0,i.jsxs)(s.p,{children:["The BPU has alignment requirements for data. Valid data arrangement and aligned data arrangement are represented by ",(0,i.jsx)(s.code,{children:"validShape"}),"and ",(0,i.jsx)(s.code,{children:"stride"})," in ",(0,i.jsx)(s.code,{children:"hbDNNTensorProperties"}),"."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"validShape"})," is the shape of the valid data."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"stride"})," represents the stride of each dimension of ",(0,i.jsx)(s.code,{children:"validShape"}),", describing the number of bytes required to cross each dimension of the tensor.\nNote that models with ",(0,i.jsx)(s.code,{children:"hbDNNDataType"})," as NV12 or Y type inputs are special cases where the obtained ",(0,i.jsx)(s.code,{children:"stride"})," is always 0, because these types of inputs only require alignment in the width (W) direction by 32."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["The model input and output tensors can get the correct data layout through ",(0,i.jsx)(s.code,{children:"validShape"})," and ",(0,i.jsx)(s.code,{children:"stride"}),".\nFor example, if the getted model input attribute ",(0,i.jsx)(s.code,{children:"hbDNNDataType = HB_DNN_TENSOR_TYPE_U16"}),", ",(0,i.jsx)(s.code,{children:"validShape = [1, 3, 212, 212]"})," and ",(0,i.jsx)(s.code,{children:"stride = [301056, 100352, 448, 2]"}),",\nthis indicates that the valid input size of the model is ",(0,i.jsx)(s.code,{children:"1x3x212x212"})," ."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"stride[3] = 2"})," indicates that each element is 16 bits in size."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"stride[2] = 448 = 2 * 224"})," indicates that the dimension at ",(0,i.jsx)(s.code,{children:"index=3"})," is aligned according to ",(0,i.jsx)(s.code,{children:"224"}),", therefore the stride for the dimension at ",(0,i.jsx)(s.code,{children:"index=3"})," is ",(0,i.jsx)(s.code,{children:"448"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"stride[1] = 100352 = 448 * 224"})," indicates that the dimension at ",(0,i.jsx)(s.code,{children:"index=2"})," is also aligned according to ",(0,i.jsx)(s.code,{children:"224"}),", therefore the stride for the dimension at ",(0,i.jsx)(s.code,{children:"index=2"})," is ",(0,i.jsx)(s.code,{children:"100352"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"stride[0] = 301056 = 100352 * 3"})," indicates that ithe dimension at ",(0,i.jsx)(s.code,{children:"index=1"})," is aligned according to ",(0,i.jsx)(s.code,{children:"3"})," , consistent with the valid size, therefore the stride for the dimension at ",(0,i.jsx)(s.code,{children:"index=1"})," is ",(0,i.jsx)(s.code,{children:"301056"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["In subsequent usage scenarios, considering the alignment requirements, when ",(0,i.jsx)(s.code,{children:"alignedByteSize > 0"}),", it is recommended to apply for memory space according to the size of ",(0,i.jsx)(s.code,{children:"alignedByteSize"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"You can use the following method to determine whether the model input needs to be aligned. If the formula does not hold, you need to perform additional alignment operations on the input data."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsxs)(s.span,{className:"katex",children:[(0,i.jsx)(s.span,{className:"katex-mathml",children:(0,i.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(s.semantics,{children:[(0,i.jsxs)(s.mrow,{children:[(0,i.jsxs)(s.msubsup,{children:[(0,i.jsx)(s.mo,{children:"\u220F"}),(0,i.jsxs)(s.mrow,{children:[(0,i.jsx)(s.mi,{children:"i"}),(0,i.jsx)(s.mo,{children:"="}),(0,i.jsx)(s.mn,{children:"1"})]}),(0,i.jsxs)(s.mrow,{children:[(0,i.jsx)(s.mi,{children:"n"}),(0,i.jsx)(s.mo,{children:"\u2212"}),(0,i.jsx)(s.mn,{children:"1"})]})]}),(0,i.jsx)(s.mi,{children:"v"}),(0,i.jsx)(s.mi,{children:"a"}),(0,i.jsx)(s.mi,{children:"l"}),(0,i.jsx)(s.mi,{children:"i"}),(0,i.jsx)(s.mi,{children:"d"}),(0,i.jsx)(s.mi,{children:"S"}),(0,i.jsx)(s.mi,{children:"h"}),(0,i.jsx)(s.mi,{children:"a"}),(0,i.jsx)(s.mi,{children:"p"}),(0,i.jsx)(s.mi,{children:"e"}),(0,i.jsx)(s.mi,{mathvariant:"normal",children:"."}),(0,i.jsx)(s.mi,{children:"d"}),(0,i.jsx)(s.mi,{children:"i"}),(0,i.jsx)(s.mi,{children:"m"}),(0,i.jsx)(s.mi,{children:"e"}),(0,i.jsx)(s.mi,{children:"n"}),(0,i.jsx)(s.mi,{children:"s"}),(0,i.jsx)(s.mi,{children:"i"}),(0,i.jsx)(s.mi,{children:"o"}),(0,i.jsx)(s.mi,{children:"n"}),(0,i.jsx)(s.mi,{children:"S"}),(0,i.jsx)(s.mi,{children:"i"}),(0,i.jsx)(s.mi,{children:"z"}),(0,i.jsx)(s.mi,{children:"e"}),(0,i.jsx)(s.mo,{stretchy:"false",children:"["}),(0,i.jsx)(s.mi,{children:"i"}),(0,i.jsx)(s.mo,{stretchy:"false",children:"]"}),(0,i.jsx)(s.mo,{children:"="}),(0,i.jsx)(s.mo,{children:"="}),(0,i.jsx)(s.mi,{children:"s"}),(0,i.jsx)(s.mi,{children:"t"}),(0,i.jsx)(s.mi,{children:"r"}),(0,i.jsx)(s.mi,{children:"i"}),(0,i.jsx)(s.mi,{children:"d"}),(0,i.jsx)(s.mi,{children:"e"}),(0,i.jsx)(s.mo,{stretchy:"false",children:"["}),(0,i.jsx)(s.mn,{children:"0"}),(0,i.jsx)(s.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\prod_{i=1}^{n-1}validShape.dimensionSize[i] == stride[0]"})]})})}),(0,i.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(s.span,{className:"base",children:[(0,i.jsx)(s.span,{className:"strut",style:{height:"1.2537em",verticalAlign:"-0.2997em"}}),(0,i.jsxs)(s.span,{className:"mop",children:[(0,i.jsx)(s.span,{className:"mop op-symbol small-op",style:{position:"relative",top:"0em"},children:"\u220F"}),(0,i.jsx)(s.span,{className:"msupsub",children:(0,i.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(s.span,{className:"vlist-r",children:[(0,i.jsxs)(s.span,{className:"vlist",style:{height:"0.954em"},children:[(0,i.jsxs)(s.span,{style:{top:"-2.4003em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(s.span,{className:"mord mtight",children:[(0,i.jsx)(s.span,{className:"mord mathnormal mtight",children:"i"}),(0,i.jsx)(s.span,{className:"mrel mtight",children:"="}),(0,i.jsx)(s.span,{className:"mord mtight",children:"1"})]})})]}),(0,i.jsxs)(s.span,{style:{top:"-3.2029em",marginRight:"0.05em"},children:[(0,i.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(s.span,{className:"mord mtight",children:[(0,i.jsx)(s.span,{className:"mord mathnormal mtight",children:"n"}),(0,i.jsx)(s.span,{className:"mbin mtight",children:"\u2212"}),(0,i.jsx)(s.span,{className:"mord mtight",children:"1"})]})})]})]}),(0,i.jsx)(s.span,{className:"vlist-s",children:"\u200B"})]}),(0,i.jsx)(s.span,{className:"vlist-r",children:(0,i.jsx)(s.span,{className:"vlist",style:{height:"0.2997em"},children:(0,i.jsx)(s.span,{})})})]})})]}),(0,i.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"a"}),(0,i.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,i.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"S"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"ha"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,i.jsx)(s.span,{className:"mord",children:"."}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"im"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"n"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"n"}),(0,i.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"S"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"ze"}),(0,i.jsx)(s.span,{className:"mopen",children:"["}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,i.jsx)(s.span,{className:"mclose",children:"]"}),(0,i.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(s.span,{className:"mrel",children:"=="}),(0,i.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(s.span,{className:"base",children:[(0,i.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,i.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,i.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,i.jsx)(s.span,{className:"mopen",children:"["}),(0,i.jsx)(s.span,{className:"mord",children:"0"}),(0,i.jsx)(s.span,{className:"mclose",children:"]"})]})]})]}),", where, ",(0,i.jsx)(s.code,{children:"n=validShape.numDimensions"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"model-input-and-output-memory-requirements",children:[(0,i.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#model-input-and-output-memory-requirements",children:"#"}),"Model input and output memory requirements"]}),"\n",(0,i.jsxs)(s.p,{children:["BPU has an alignment restriction on the first address of the model input and output memory, requiring the first address of the input and output memory to be ",(0,i.jsx)(s.code,{children:"32"})," aligned."]}),"\n",(0,i.jsxs)(s.div,{className:"rspress-directive info",children:[(0,i.jsx)(s.div,{className:"rspress-directive-title",children:"Note"}),(0,i.jsx)(s.div,{className:"rspress-directive-content",children:(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["The first address of the memory requested by ",(0,i.jsx)(s.a,{href:"/3.0.22/en/guide/ucp/ucp_api_reference/ucp_api_function_interface/hbucpmalloc.html",children:"hbUCPMalloc"})," and ",(0,i.jsx)(s.a,{href:"/3.0.22/en/guide/ucp/ucp_api_reference/ucp_api_function_interface/hbucpmalloccached.html",children:"hbUCPMallocCached"})," interfaces is aligned to ",(0,i.jsx)(s.code,{children:"32"})," by default."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["When you request the memory and use the offset address as the input of the model, please check whether the first address after the offset is ",(0,i.jsx)(s.code,{children:"32"})," aligned."]}),"\n"]}),"\n"]})})]})]})}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,a.ah)(),e.components);return s?(0,i.jsx)(s,Object.assign({},e,{children:(0,i.jsx)(t,e)})):t(e)}s.default=d,d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["3.0.22%2Fen%2Fguide%2Fucp%2Fruntime%2Fbpu_sdk_api%2Falignment_rule.mdx"]={toc:[{id:"model-input-requirement",text:"Model Input Requirement",depth:2},{id:"alignment-and-efficient-data",text:"Alignment and Efficient Data",depth:2},{id:"model-input-and-output-memory-requirements",text:"Model input and output memory requirements",depth:3}],title:"Alignment Rule",frontmatter:{}}},95895:function(e,s,n){n(39710);var i=n(85893),a=n(67294),r=n(45687);n(20388);let t={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function d(e,s,n){let i=Object.keys(t).includes(s)?s:n;return t[i](e)}s.Z=e=>{let{defaultLocale:s="en-US"}=e,n=(0,r.Vi)().page.readingTimeData,t=(0,r.Jr)(),l=(0,r.e7)(),[c,h]=(0,a.useState)(d(n,t,s));return(0,a.useEffect)(()=>{h(d(n,t,s))},[t,n]),(0,i.jsx)("span",{"data-dark":String(l),className:"rp-reading-time",children:c})}}}]);