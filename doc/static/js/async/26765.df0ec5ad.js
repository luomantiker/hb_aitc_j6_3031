"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["26765"],{3493:function(n,e,s){s.r(e);var l=s(85893),r=s(50065),i=s(95895);function o(n){let e=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",ol:"ol",li:"li",div:"div",pre:"pre",code:"code",span:"span",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,r.ah)(),n.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(e.h1,{id:"prepare-\u8BE6\u89E3",children:[(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#prepare-\u8BE6\u89E3",children:"#"}),"prepare \u8BE6\u89E3"]}),"\n",(0,l.jsx)(i.Z,{}),"\n",(0,l.jsxs)(e.h2,{id:"prepare-\u7684\u5B9A\u4E49",children:[(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#prepare-\u7684\u5B9A\u4E49",children:"#"}),"prepare \u7684\u5B9A\u4E49"]}),"\n",(0,l.jsx)(e.p,{children:"prepare \u662F\u5C06\u6D6E\u70B9\u6A21\u578B\u8F6C\u6362\u4E3A\u4F2A\u91CF\u5316\u6A21\u578B\u7684\u8FC7\u7A0B\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u4F1A\u505A\u4EE5\u4E0B\u51E0\u4EF6\u4E8B\u60C5\uFF1A"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u7B97\u5B50\u66FF\u6362\uFF1A\u90E8\u5206 torch function \u7C7B\u578B\u7684\u7B97\u5B50\uFF08\u4F8B\u5982 F.interpolate\uFF09\u5728\u91CF\u5316\u65F6\u9700\u8981\u63D2\u5165\u4F2A\u91CF\u5316\u8282\u70B9\uFF0C\u56E0\u6B64\u9700\u8981\u5C06\u7B97\u5B50\u66FF\u6362\u4E3A\u5BF9\u5E94\u7684 Module \u7C7B\u578B\u5B9E\u73B0\uFF08horizon_plugin_pytorch.nn.Interpolate\uFF09\uFF0C\u4EE5\u5C06\u4F2A\u91CF\u5316\u8282\u70B9\u653E\u5728\u6B64 Module \u5185\u90E8\u3002\u66FF\u6362\u524D\u540E\u7684\u6A21\u578B\u662F\u7B49\u4EF7\u7684\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u7B97\u5B50\u878D\u5408\uFF1ABPU \u652F\u6301\u5C06\u7279\u5B9A\u7684\u8BA1\u7B97 pattern \u8FDB\u884C\u878D\u5408\uFF0C\u878D\u5408\u540E\u7B97\u5B50\u4E2D\u95F4\u7ED3\u679C\u7528\u9AD8\u7CBE\u5EA6\u8868\u793A\uFF0C\u56E0\u6B64\u6211\u4EEC\u5C06\u88AB\u878D\u5408\u7684\u591A\u4E2A\u7B97\u5B50\u66FF\u6362\u4E3A\u4E00\u4E2A Module\uFF0C\u4EE5\u963B\u6B62\u4E2D\u95F4\u7ED3\u679C\u7684\u91CF\u5316\u3002\u878D\u5408\u524D\u540E\u7684\u6A21\u578B\u4E5F\u662F\u7B49\u4EF7\u7684\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u7B97\u5B50\u8F6C\u6362\uFF1A\u5C06\u6D6E\u70B9\u7B97\u5B50\u66FF\u6362\u4E3A qat \u7B97\u5B50\u3002\u6309\u7167\u8BBE\u7F6E\u7684 qconfig\uFF0Cqat \u7B97\u5B50\u4F1A\u5728\u8F93\u5165/\u8F93\u51FA/\u6743\u91CD\u5904\u6DFB\u52A0\u4F2A\u91CF\u5316/\u4F2A\u8F6C\u6362\u8282\u70B9\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u6A21\u578B\u7ED3\u6784\u68C0\u67E5\uFF1A\u68C0\u67E5 qat \u6A21\u578B\uFF0C\u751F\u6210\u68C0\u67E5\u7ED3\u679C\u6587\u4EF6\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.div,{className:"rspress-directive warning",children:[(0,l.jsx)(e.div,{className:"rspress-directive-title",children:"\u6CE8\u610F"}),(0,l.jsx)(e.div,{className:"rspress-directive-content",children:(0,l.jsx)(e.p,{children:"\n\u56E0\u5386\u53F2\u539F\u56E0\uFF0CPlugin \u4E2D\u6709 prepare_qat \u548C prepare_qat_fx \u4E24\u4E2A\u65E9\u671F\u7684\u63A5\u53E3\uFF0C\u540E\u9762\u5C06\u9010\u6B65\u5E9F\u5F03\uFF0C\u6211\u4EEC\u53EA\u63A8\u8350\u60A8\u4F7F\u7528\u6B64\u6587\u6863\u4E2D\u4ECB\u7ECD\u7684 prepare \u7528\u6CD5\u3002"})})]}),"\n",(0,l.jsx)(e.p,{children:"prepare \u63A5\u53E3\u7684\u7528\u6CD5\u5982\u4E0B\uFF1A"}),"\n",(0,l.jsx)(e.pre,{className:"code",children:(0,l.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,l.jsxs)(e.code,{className:"language-py",meta:"",children:[(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" horizon_plugin_pytorch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"prepare "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" prepare"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" PrepareMethod"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" horizon_plugin_pytorch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"qconfig_template "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    default_qat_qconfig_setter"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    sensitive_op_qat_8bit_weight_16bit_fixed_act_qconfig_setter"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u4F7F\u7528\u6A21\u677F\u65F6\u5FC5\u987B\u63D0\u4F9B example_inputs \u548C qconfig_setter\u3002"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# method \u4E3A PrepareMethod.JIT_STRIP \u6216 PrepareMethod.JIT \u65F6\uFF0C\u5FC5\u987B\u63D0\u4F9B example_inputs\u3002"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# def prepare("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     model: torch.nn.Module,"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     example_inputs: Any = None,   # \u7528\u6765\u611F\u77E5\u56FE\u7ED3\u6784\uFF0C\u786E\u4FDD\u53EF\u4EE5\u7528\u6765\u8DD1\u901A forward\u3002"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     qconfig_setter: Optional[Union[Tuple[QconfigSetterBase, ...], QconfigSetterBase]] = None,  # qconfig \u6A21\u677F\uFF0C\u652F\u6301\u4F20\u5165\u591A\u4E2A\u6A21\u677F\uFF0C\u4F18\u5148\u7EA7\u4ECE\u9AD8\u5230\u4F4E\u3002"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     method: PrepareMethod = PrepareMethod.JIT_STRIP,  # prepare \u6A21\u5F0F"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# ) -> torch.nn.Module:"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"qat_model "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"prepare"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    float_model,"})}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    example_inputs"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"example_inputs,"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    qconfig_setter"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"sensitive_op_qat_8bit_weight_16bit_fixed_act_qconfig_setter"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(table, ratio"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.2"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"),"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        default_qat_qconfig_setter,"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    ),"})}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    method"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"PrepareMethod.JIT,"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,l.jsxs)(e.h2,{id:"preparemethod",children:[(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#preparemethod",children:"#"}),"PrepareMethod"]}),"\n",(0,l.jsx)(e.p,{children:"prepare \u6709\u56DB\u79CD method\uFF0C\u4ED6\u4EEC\u7684\u5BF9\u6BD4\u5982\u4E0B\uFF1A"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"method"}),(0,l.jsx)(e.th,{children:"\u539F\u7406"}),(0,l.jsx)(e.th,{children:"\u4F18\u70B9"}),(0,l.jsx)(e.th,{children:"\u7F3A\u70B9"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"PrepareMethod.JIT & PrepareMethod.JIT_STRIP"}),(0,l.jsx)(e.td,{children:"\u4F7F\u7528 hook \u548C subclass tensor \u7684\u65B9\u5F0F\u611F\u77E5\u56FE\u7ED3\u6784\uFF0C\u5728\u539F\u6709 forward \u4E0A\u505A\u7B97\u5B50\u66FF\u6362/\u7B97\u5B50\u878D\u5408\u7B49\u64CD\u4F5C\u3002"}),(0,l.jsx)(e.td,{children:"\u5168\u81EA\u52A8\uFF0C\u4EE3\u7801\u4FEE\u6539\u5C11\uFF0C\u5C4F\u853D\u4E86\u5F88\u591A\u7EC6\u8282\u95EE\u9898\uFF0C\u4FBF\u4E8E debug\u3002"}),(0,l.jsx)(e.td,{children:"\u52A8\u6001\u4EE3\u7801\u5757\u9700\u8981\u7279\u6B8A\u5904\u7406\u3002"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"PrepareMethod.SYMBOLIC"}),(0,l.jsxs)(e.td,{children:["\u4F7F\u7528 torch \u5B98\u65B9\u7684 ",(0,l.jsx)(e.a,{href:"https://pytorch.org/docs/stable/fx.html",target:"_blank",rel:"noopener noreferrer",children:"symbolic trace"})," \u611F\u77E5\u56FE\u7ED3\u6784\uFF0C\u5728 recomplie \u751F\u6210\u7684\u65B0 forward \u4E0A\u505A\u7B97\u5B50\u66FF\u6362/\u7B97\u5B50\u878D\u5408\u7B49\u64CD\u4F5C\u3002"]}),(0,l.jsx)(e.td,{children:"\u5168\u81EA\u52A8\uFF0C\u5C4F\u853D\u4E86\u5F88\u591A\u7EC6\u8282\u95EE\u9898\u3002"}),(0,l.jsx)(e.td,{children:"\u4E0D\u652F\u6301\u52A8\u6001\u63A7\u5236\u6D41\uFF0C\u4E0D\u652F\u6301\u90E8\u5206\u6570\u636E\u7C7B\u578B\u548C python \u64CD\u4F5C\uFF0C\u4E0D\u4FBF\u4E8E debug\u3002"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"PrepareMethod.EAGER"}),(0,l.jsx)(e.td,{children:"\u4E0D\u611F\u77E5\u56FE\u7ED3\u6784\uFF0C\u7B97\u5B50\u66FF\u6362/\u7B97\u5B50\u878D\u5408\u9700\u624B\u52A8\u8FDB\u884C\u3002"}),(0,l.jsx)(e.td,{children:"\u7528\u6CD5\u7075\u6D3B\uFF0C\u8FC7\u7A0B\u53EF\u63A7\uFF0C\u4FBF\u4E8E debug \u548C\u5904\u7406\u5404\u7C7B\u7279\u6B8A\u9700\u6C42\u3002"}),(0,l.jsx)(e.td,{children:"\u624B\u52A8\u64CD\u4F5C\u8F83\u591A\uFF0C\u4EE3\u7801\u4FEE\u6539\u591A\uFF0C\u4E0A\u624B\u6210\u672C\u9AD8\u3002"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:"\u76EE\u524D\uFF0CJIT \u548C JIT_STRIP \u4E3A\u6211\u4EEC\u63A8\u8350\u7684 method\uFF0C\u4E24\u8005\u7684\u533A\u522B\u5728\u4E8E JIT_STRIP \u4F1A\u6839\u636E\u6A21\u578B\u4E2D QuantStub \u548C DequantStub \u7684\u4F4D\u7F6E\u8BC6\u522B\u5E76\u8DF3\u8FC7\u524D\u540E\u5904\u7406\uFF0C\u56E0\u6B64\u5F53\u6A21\u578B\u4E2D\u5B58\u5728\u4E0D\u9700\u8981\u91CF\u5316\u7684\u524D\u540E\u5904\u7406\u65F6\uFF0C\u8BF7\u4F7F\u7528 JIT_STRIP\uFF0C\u5426\u5219\u5B83\u4EEC\u5C06\u88AB\u91CF\u5316\uFF0C\u9664\u6B64\u4EE5\u5916\uFF0C\u4E24\u8005\u5B8C\u5168\u4E00\u81F4\u3002SYMBOLIC \u548C EAGER \u4E3A\u65E9\u671F\u65B9\u6848\uFF0C\u5B58\u5728\u8F83\u591A\u6613\u7528\u6027\u95EE\u9898\uFF0C\u6211\u4EEC\u5EFA\u8BAE\u60A8\u4E0D\u8981\u4F7F\u7528\u8FD9\u4E24\u79CD\u65B9\u6848\u3002"}),"\n",(0,l.jsxs)(e.h2,{id:"\u4F7F\u7528\u793A\u4F8B",children:[(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4F7F\u7528\u793A\u4F8B",children:"#"}),"\u4F7F\u7528\u793A\u4F8B"]}),"\n",(0,l.jsx)(e.pre,{className:"code",children:(0,l.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,l.jsxs)(e.code,{className:"language-py",meta:"",children:[(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" copy"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" numpy "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" np"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" nn"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"nn "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" functional "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" F"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" DeQuantStub"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" QuantStub"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" horizon_plugin_pytorch "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" March"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" set_march"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" horizon_plugin_pytorch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"fx"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"jit_scheme "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" Tracer"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" horizon_plugin_pytorch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    FakeQuantState"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    get_qconfig"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    PrepareMethod"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    prepare"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    set_fake_quantize"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Net"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"torch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"nn"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Module"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"):"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"__init__"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"input_size"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"class_num"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"->"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"None"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:":"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"super"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"__init__"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quant0 "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"QuantStub"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quant1 "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"QuantStub"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"dequant "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"DeQuantStub"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"conv "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" nn"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Conv2d"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"bn "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" nn"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BatchNorm2d"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"classifier "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" nn"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Conv2d"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", class_num, input_size)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"loss "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" nn"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"CrossEntropyLoss"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"forward"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"input"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"other"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"target"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"None"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"):"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u4E0D\u9700\u8981\u91CF\u5316\u7684\u524D\u5904\u7406\uFF0C\u4F7F\u7528 JIT_STRIP \u65F6\uFF0C\u5C06\u8FD9\u4E9B\u64CD\u4F5C\u4ECE\u8BA1\u7B97\u56FE\u4E2D\u5254\u9664\u3002"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"input"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"input"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"128.0"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        x "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"quant0"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"input"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        y "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"quant1"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(other)"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        n "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" np"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"random"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"randint"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"5"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u7531\u4E8E\u4E0D\u91CD\u65B0\u751F\u6210 python code\uFF0C\u6B64\u52A8\u6001\u5FAA\u73AF\u5728 QAT \u6A21\u578B\u4E2D\u4FDD\u7559\u3002"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"range"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(n):"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u52A8\u6001\u5FAA\u73AF\u4E2D\u7684\u4EE3\u7801\u5757\u6D89\u53CA\u5230\u7B97\u5B50\u66FF\u6362\u6216\u7B97\u5B50\u878D\u5408\u65F6\uFF0C\u5FC5\u987B\u8FDB\u884C\u6807\u6CE8"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"with"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" Tracer"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dynamic_block"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(self, "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"ConvBnAdd"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"):"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                x "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"conv"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(x)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                x "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"bn"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(x)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                x "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" x "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"+"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" y"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        x "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"classifier"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(x)."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"squeeze"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u7531\u4E8E\u4E0D\u91CD\u65B0\u751F\u6210 python code\uFF0C\u6B64\u52A8\u6001\u63A7\u5236\u6D41\u5728 QAT \u6A21\u578B\u4E2D\u4FDD\u7559"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"training"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"assert"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" target "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"not"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"None"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            x "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"dequant"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(x)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" F"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"cross_entropy"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(torch."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"softmax"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(x, dim"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"), target)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"argmax"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(x, dim"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"model "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Net"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"6"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"train_example_input "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    torch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"rand"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"6"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"6"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"256"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    torch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"rand"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"6"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"6"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"),"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    torch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"tensor"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"([["}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.0"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1.0"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"], ["}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1.0"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.0"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"]]),"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"eval_example_input "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" train_example_input"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"[:"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"]"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"model"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"eval"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"set_march"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(March.NASH_E)"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"model"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"qconfig "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"get_qconfig"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"qat_model "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"prepare"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    model,"})}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    example_inputs"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"copy."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"deepcopy"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(eval_example_input),"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    method"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"PrepareMethod.JIT_STRIP,"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"qat_model"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"graph"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"print_tabular"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# opcode         name              target                                                     args                              kwargs"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# -------------  ----------------  ---------------------------------------------------------  --------------------------------  ----------"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# placeholder    input_0           input_0                                                    ()                                {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_module    quant0            quant0                                                     (input_0,)                        {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# placeholder    input_1           input_1                                                    ()                                {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_module    quant1            quant1                                                     (input_1,)                        {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_module    conv              conv                                                       (quant0,)                         {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_module    bn                bn                                                         (conv,)                           {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# get_attr       _generated_add_0  _generated_add_0                                           ()                                {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_method    add_2             add                                                        (_generated_add_0, bn, quant1)    {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# scope_end \u662F\u5728 trace \u8FC7\u7A0B\u4E2D\u81EA\u52A8\u63D2\u5165\u7684\uFF0C\u7528\u4E8E\u6807\u8BB0\u5B50 module \u6216\u52A8\u6001\u4EE3\u7801\u5757\u7684\u8FB9\u754C\uFF0C\u4E0D\u5BF9\u5E94\u5B9E\u9645\u8BA1\u7B97"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_function  scope_end         <function Tracer.scope_end at 0x7f65d90e5e50>              ('_dynamic_block_ConvBnAdd',)     {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_module    conv_1            conv                                                       (add_2,)                          {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_module    bn_1              bn                                                         (conv_1,)                         {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# get_attr       _generated_add_1  _generated_add_0                                           ()                                {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_method    add_3             add                                                        (_generated_add_1, bn_1, quant1)  {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_function  scope_end_1       <function Tracer.scope_end at 0x7f65d90e5e50>              ('_dynamic_block_ConvBnAdd',)     {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_module    classifier        classifier                                                 (add_3,)                          {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_function  squeeze           <method 'squeeze' of 'torch._C._TensorBase' objects>       (classifier,)                     {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_function  argmax            <built-in method argmax of type object at 0x7f66f04cf820>  (squeeze,)                        {'dim': 1}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# call_function  scope_end_2       <function Tracer.scope_end at 0x7f65d90e5e50>              ('',)                             {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# output         output            output                                                     ((argmax,),)                      {}"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"print"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(qat_model)"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# GraphModuleImpl("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (quant0): QuantStub("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (activation_post_process): FakeQuantize("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       fake_quant_enabled=tensor([1], dtype=torch.uint8), observer_enabled=tensor([1], dtype=torch.uint8),            quant_min=-128, quant_max=127, dtype=qint8, qscheme=torch.per_tensor_symmetric, ch_axis=-1,         scale=tensor([1.]), zero_point=tensor([0])"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       (activation_post_process): MinMaxObserver(min_val=tensor([]), max_val=tensor([]))"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (quant1): QuantStub("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (activation_post_process): FakeQuantize("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       fake_quant_enabled=tensor([1], dtype=torch.uint8), observer_enabled=tensor([1], dtype=torch.uint8),            quant_min=-128, quant_max=127, dtype=qint8, qscheme=torch.per_tensor_symmetric, ch_axis=-1,         scale=tensor([1.]), zero_point=tensor([0])"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       (activation_post_process): MinMaxObserver(min_val=tensor([]), max_val=tensor([]))"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (dequant): DeQuantStub()"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (conv): Identity()  # \u7531\u4E8E forward \u4EE3\u7801\u4E0D\u53D8\uFF0Cconv \u548C bn \u4ECD\u5C06\u88AB\u6267\u884C\uFF0C\u6240\u4EE5\u878D\u5408\u540E\u5FC5\u987B\u5C06 Conv \u548C Bn \u66FF\u6362\u4E3A Identity"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (bn): Identity()"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (classifier): Conv2d("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     3, 2, kernel_size=(6, 6), stride=(1, 1)"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (activation_post_process): FakeQuantize("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       fake_quant_enabled=tensor([1], dtype=torch.uint8), observer_enabled=tensor([1], dtype=torch.uint8),            quant_min=-128, quant_max=127, dtype=qint8, qscheme=torch.per_tensor_symmetric, ch_axis=-1,         scale=tensor([1.]), zero_point=tensor([0])"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       (activation_post_process): MinMaxObserver(min_val=tensor([]), max_val=tensor([]))"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (weight_fake_quant): FakeQuantize("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       fake_quant_enabled=tensor([1], dtype=torch.uint8), observer_enabled=tensor([1], dtype=torch.uint8),            quant_min=-128, quant_max=127, dtype=qint8, qscheme=torch.per_channel_symmetric, ch_axis=0,         scale=tensor([1., 1.]), zero_point=tensor([0, 0])"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       (activation_post_process): MinMaxObserver(min_val=tensor([]), max_val=tensor([]))"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (loss): CrossEntropyLoss()"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (_generated_add_0): ConvAdd2d(  # \u81EA\u52A8\u5C06 '+' \u66FF\u6362\u4E3A Module \u5F62\u5F0F\uFF0C\u5E76\u5C06 Conv \u548C Bn \u878D\u5408\u8FDB\u6765"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     3, 3, kernel_size=(1, 1), stride=(1, 1)"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (activation_post_process): FakeQuantize("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       fake_quant_enabled=tensor([1], dtype=torch.uint8), observer_enabled=tensor([1], dtype=torch.uint8),            quant_min=-128, quant_max=127, dtype=qint8, qscheme=torch.per_tensor_symmetric, ch_axis=-1,         scale=tensor([1.]), zero_point=tensor([0])"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       (activation_post_process): MinMaxObserver(min_val=tensor([]), max_val=tensor([]))"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (weight_fake_quant): FakeQuantize("})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       fake_quant_enabled=tensor([1], dtype=torch.uint8), observer_enabled=tensor([1], dtype=torch.uint8),            quant_min=-128, quant_max=127, dtype=qint8, qscheme=torch.per_channel_symmetric, ch_axis=0,         scale=tensor([1., 1., 1.]), zero_point=tensor([0, 0, 0])"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#       (activation_post_process): MinMaxObserver(min_val=tensor([]), max_val=tensor([]))"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# )"})}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"qat_model"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"train"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"set_fake_quantize"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(qat_model, FakeQuantState.QAT)"})]}),"\n",(0,l.jsx)(e.span,{className:"line line-number"}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" _ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"range"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"):"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ret "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"qat_model"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"train_example_input)"})]}),"\n",(0,l.jsxs)(e.span,{className:"line line-number",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ret"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"backward"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n"]})})}),"\n",(0,l.jsxs)(e.div,{className:"rspress-directive warning",children:[(0,l.jsx)(e.div,{className:"rspress-directive-title",children:"\u6CE8\u610F"}),(0,l.jsx)(e.div,{className:"rspress-directive-content",children:(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u52A8\u6001\u4EE3\u7801\u5757\u6D89\u53CA\u5230\u7B97\u5B50\u66FF\u6362\u6216\u7B97\u5B50\u878D\u5408\u65F6\uFF0C\u5FC5\u987B\u4F7F\u7528 Tracer.dynamic_block \u8FDB\u884C\u6807\u6CE8\uFF0C\u5426\u5219\u5C06\u5BFC\u81F4\u91CF\u5316\u4FE1\u606F\u9519\u4E71\u6216 forward \u62A5\u9519\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u6A21\u578B\u4E2D\u8C03\u7528\u6B21\u6570\u53D8\u5316\u7684\u90E8\u5206\uFF08\u5B50 module \u6216 dynamic_block\uFF09\uFF0C\u82E5\u5728 trace \u65F6\u4EC5\u6267\u884C\u4E86\u4E00\u6B21\uFF0C\u5219\u6709\u53EF\u80FD\u548C\u975E\u52A8\u6001\u90E8\u5206\u4EA7\u751F\u7B97\u5B50\u878D\u5408\uFF0C\u5BFC\u81F4 forward \u62A5\u9519\u3002"}),"\n"]})})]}),"\n",(0,l.jsxs)(e.h2,{id:"\u6A21\u578B\u68C0\u67E5",children:[(0,l.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6A21\u578B\u68C0\u67E5",children:"#"}),"\u6A21\u578B\u68C0\u67E5"]}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u63D0\u4F9B example_inputs \u7684\u60C5\u51B5\u4E0B\uFF0Cprepare \u9ED8\u8BA4\u4F1A\u5BF9\u6A21\u578B\u7ED3\u6784\u8FDB\u884C\u68C0\u67E5\u3002\u5982\u679C\u68C0\u67E5\u5B8C\u6210\uFF0C\u53EF\u4EE5\u5728\u8FD0\u884C\u76EE\u5F55\u4E0B\u627E\u5230 model_check_result.txt \u6587\u4EF6\uFF0C\u5982\u679C\u68C0\u67E5\u5931\u8D25\uFF0C\u5219\u9700\u8981\u6839\u636E\u8B66\u544A\u63D0\u793A\u4FEE\u6539\u6A21\u578B\u6216\u5355\u72EC\u8C03\u7528 horizon_plugin_pytorch.utils.check_model.check_qat_model \u68C0\u67E5\u6A21\u578B\u3002\u68C0\u67E5\u6D41\u7A0B\u548C debug \u5DE5\u5177\u4E2D\u7684 check_qat_model \u4E00\u81F4\uFF0C\u7ED3\u679C\u6587\u4EF6\u7684\u5206\u6790\u8BE6\u89C1 check_qat_model \u76F8\u5173\u6587\u6863\u3002"})]})}function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,r.ah)(),n.components);return e?(0,l.jsx)(e,Object.assign({},n,{children:(0,l.jsx)(o,n)})):o(n)}e.default=t,t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["3.0.22%2Fzh%2Fguide%2Fplugin%2Fuser_guide%2Fprepare.mdx"]={toc:[{id:"prepare-\u7684\u5B9A\u4E49",text:"prepare \u7684\u5B9A\u4E49",depth:2},{id:"preparemethod",text:"PrepareMethod",depth:2},{id:"\u4F7F\u7528\u793A\u4F8B",text:"\u4F7F\u7528\u793A\u4F8B",depth:2},{id:"\u6A21\u578B\u68C0\u67E5",text:"\u6A21\u578B\u68C0\u67E5",depth:2}],title:"prepare \u8BE6\u89E3",frontmatter:{}}},95895:function(n,e,s){s(39710);var l=s(85893),r=s(67294),i=s(45687);s(20388);let o={"zh-CN":n=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${n.minutes>=1?`${Math.ceil(n.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":n=>`Estimated reading time: ${n.minutes>=1?`${Math.ceil(n.minutes)} minutes`:"less than 1 minute"}`};function t(n,e,s){let l=Object.keys(o).includes(e)?e:s;return o[l](n)}e.Z=n=>{let{defaultLocale:e="en-US"}=n,s=(0,i.Vi)().page.readingTimeData,o=(0,i.Jr)(),a=(0,i.e7)(),[c,h]=(0,r.useState)(t(s,o,e));return(0,r.useEffect)(()=>{h(t(s,o,e))},[o,s]),(0,l.jsx)("span",{"data-dark":String(a),className:"rp-reading-time",children:c})}}}]);