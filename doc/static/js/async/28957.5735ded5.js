"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["28957"],{25895:function(e,n,s){s.r(n);var l=s(85893),i=s(50065),o=s(95895);function r(e){let n=Object.assign({h1:"h1",a:"a",p:"p",strong:"strong",ul:"ul",li:"li",pre:"pre",code:"code",span:"span"},(0,i.ah)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.h1,{id:"quantizationfuse_modules",children:[(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#quantizationfuse_modules",children:"#"}),"quantization.fuse_modules"]}),"\n",(0,l.jsx)(o.Z,{}),"\n",(0,l.jsx)(n.p,{}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"horizon_plugin_pytorch.quantization.fuse_modules (model, modules_to_fuse, inplace=False, fuser_func=<function fuse_known_modules>, fuse_custom_config_dict=None)"})}),"\n",(0,l.jsx)(n.p,{children:"Fuses a list of modules into a single module."}),"\n",(0,l.jsx)(n.p,{children:"Fuses only the following sequence of modules:\nconv, bn;\nconv, bn, relu;\nconv, relu;\nconv, bn, add;\nconv, bn, add, relu;\nconv, add;\nconv, add, relu;\nlinear, bn;\nlinear, bn, relu;\nlinear, relu;\nlinear, bn, add;\nlinear, bn, add, relu;\nlinear, add;\nlinear, add, relu.\nFor these sequences, the first element in the output module list performs\nthe fused operation. The rest of the elements are set to nn.Identity()"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"model"})," \u2013 Model containing the modules to be fused"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"modules_to_fuse"})," \u2013 list of list of module names to fuse. Can also be a\nlist of strings if there is only a single list of\nmodules to fuse."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"inplace"})," \u2013 bool specifying if fusion happens in place on the model, by\ndefault a new model is returned"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"fuser_func"})," \u2013 Function that takes in a list of modules and outputs a list\nof fused modules of the same length. For example,\nfuser_func([convModule, BNModule]) returns the list\n[ConvBNModule, nn.Identity()] Defaults to\ntorch.ao.quantization.fuse_known_modules"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"fuse_custom_config_dict"})," \u2013 custom configuration for fusion"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{className:"code",children:(0,l.jsx)(n.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,l.jsxs)(n.code,{className:"language-python",meta:"",children:[(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Example of fuse_custom_config_dict"})}),"\n",(0,l.jsxs)(n.span,{className:"line line-number",children:[(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"fuse_custom_config_dict "}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{"})]}),"\n",(0,l.jsxs)(n.span,{className:"line line-number",children:[(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Additional fuser_method mapping"})]}),"\n",(0,l.jsxs)(n.span,{className:"line line-number",children:[(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"additional_fuser_method_mapping"'}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"{"})]}),"\n",(0,l.jsxs)(n.span,{className:"line line-number",children:[(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"        (torch"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"nn"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"Conv2d"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" torch"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"nn"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"BatchNorm2d)"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" fuse_conv_bn"})]}),"\n",(0,l.jsxs)(n.span,{className:"line line-number",children:[(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"},"})]}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"}"})}),"\n"]})})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Returns:"}),"\nmodel with fused modules. A new copy is created if inplace=True."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Examples:"}),"\n",(0,l.jsx)(n.pre,{className:"code",children:(0,l.jsx)(n.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,l.jsxs)(n.code,{className:"language-text",meta:"",children:[(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> # xdoctest: +SKIP"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> m = M().eval()"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> # m is a module containing the sub-modules below"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> modules_to_fuse = [ ['conv1', 'bn1', 'relu1'],"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"                      ['submodule.conv', 'submodule.relu']]"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> fused_m = fuse_modules("})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"                m, modules_to_fuse)"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> output = fused_m(input)"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> m = M().eval()"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> # Alternately provide a single list of modules to fuse"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> modules_to_fuse = ['conv1', 'bn1', 'relu1']"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> fused_m = fuse_modules("})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"                m, modules_to_fuse)"})}),"\n",(0,l.jsx)(n.span,{className:"line line-number",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:">>> output = fused_m(input)"})}),"\n",(0,l.jsx)(n.span,{className:"line",children:(0,l.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})})]})})})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,l.jsx)(n,Object.assign({},e,{children:(0,l.jsx)(r,e)})):r(e)}n.default=t,t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["3.0.22%2Fzh%2Fguide%2Fplugin%2Fplugin_api_reference%2Fqat_api%2Fhorizon_plugin_pytorch_quantization_fuse_modules.md"]={toc:[],title:"quantization.fuse_modules",frontmatter:{}}},95895:function(e,n,s){s(39710);var l=s(85893),i=s(67294),o=s(45687);s(20388);let r={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function t(e,n,s){let l=Object.keys(r).includes(n)?n:s;return r[l](e)}n.Z=e=>{let{defaultLocale:n="en-US"}=e,s=(0,o.Vi)().page.readingTimeData,r=(0,o.Jr)(),a=(0,o.e7)(),[c,d]=(0,i.useState)(t(s,r,n));return(0,i.useEffect)(()=>{d(t(s,r,n))},[r,s]),(0,l.jsx)("span",{"data-dark":String(a),className:"rp-reading-time",children:c})}}}]);