"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["85184"],{6589:function(n,e,i){n.exports=i.p+"static/image/calibration_percentile_bimodal.ac8e31a5.png"},66149:function(n,e,i){n.exports=i.p+"static/image/calibration_percentile_ln.d45d73fc.png"},58055:function(n,e,i){n.exports=i.p+"static/image/calibration_percentile_longtail.e798aad6.png"},36069:function(n,e,i){n.exports=i.p+"static/image/calibration_v2_workflow.1d50ec14.png"},17785:function(n,e,i){i.r(e);var s=i(85893),r=i(50065),t=i(95895),l=i(58055),c=i(6589),a=i(66149),o=i(36069);function d(n){let e=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",ol:"ol",li:"li",code:"code",pre:"pre",span:"span",div:"div",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",img:"img",strong:"strong",em:"em",ul:"ul"},(0,r.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"calibration-\u6307\u5357",children:[(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#calibration-\u6307\u5357",children:"#"}),"Calibration \u6307\u5357"]}),"\n",(0,s.jsx)(t.Z,{}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u91CF\u5316\u4E2D\uFF0C\u4E00\u4E2A\u91CD\u8981\u7684\u6B65\u9AA4\u662F\u786E\u5B9A\u91CF\u5316\u53C2\u6570\uFF0C\u5408\u7406\u7684\u521D\u59CB\u91CF\u5316\u53C2\u6570\u80FD\u591F\u663E\u8457\u63D0\u5347\u6A21\u578B\u7CBE\u5EA6\u5E76\u52A0\u5FEB\u6A21\u578B\u7684\u6536\u655B\u901F\u5EA6\u3002Calibration \u5C31\u662F\u5728\u6D6E\u70B9\u6A21\u578B\u4E2D\u63D2\u5165 Observer\uFF0C\u4F7F\u7528\u5C11\u91CF\u8BAD\u7EC3\u6570\u636E\uFF0C\u5728\u6A21\u578B forward \u8FC7\u7A0B\u4E2D\u7EDF\u8BA1\u5404\u5904\u7684\u6570\u636E\u5206\u5E03\uFF0C\u4EE5\u786E\u5B9A\u5408\u7406\u7684\u91CF\u5316\u53C2\u6570\u7684\u8FC7\u7A0B\u3002\u867D\u7136\u4E0D\u505A Calibration \u4E5F\u53EF\u4EE5\u8FDB\u884C\u91CF\u5316\u611F\u77E5\u8BAD\u7EC3\uFF0C\u4F46\u4E00\u822C\u6765\u8BF4\uFF0C\u5B83\u5BF9\u91CF\u5316\u611F\u77E5\u8BAD\u7EC3\u6709\u76CA\u65E0\u5BB3\uFF0C\u6240\u4EE5\u63A8\u8350\u60A8\u5C06\u6B64\u6B65\u9AA4\u4F5C\u4E3A\u5FC5\u9009\u9879\u3002"}),"\n",(0,s.jsxs)(e.h2,{id:"\u6D41\u7A0B\u548C\u793A\u4F8B",children:[(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6D41\u7A0B\u548C\u793A\u4F8B",children:"#"}),"\u6D41\u7A0B\u548C\u793A\u4F8B"]}),"\n",(0,s.jsx)(e.p,{children:"Calibration \u4E0E QAT \u7684\u6574\u4F53\u6D41\u7A0B\u5982\u4E0B\u56FE\u6240\u793A\uFF1A"}),"\n",(0,s.jsx)("img",{src:o,alt:"calibration_v2_workflow",width:"450"}),"\n",(0,s.jsx)(e.p,{children:"\u4E0B\u9762\u5206\u522B\u4ECB\u7ECD\u5404\u4E2A\u6B65\u9AA4\uFF1A"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u6784\u5EFA\u5E76\u8BAD\u7EC3\u6D6E\u70B9\u6A21\u578B\u3002\u53C2\u8003 horizon_plugin_pytorch \u5FEB\u901F\u5165\u95E8\u7AE0\u8282\u4E2D\u7684 ",(0,s.jsx)(e.a,{href:"/3.0.22/zh/guide/plugin/qat_quickstart/qat_quickstart.html#%E8%8E%B7%E5%8F%96%E6%B5%AE%E7%82%B9%E6%A8%A1%E5%9E%8B",children:"\u83B7\u53D6\u6D6E\u70B9\u6A21\u578B"})," \u5C0F\u8282\u5185\u5BB9\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5728\u6D6E\u70B9\u6A21\u578B\u4E0A\u63D2\u5165 Observer \u8282\u70B9\uFF0C\u53C2\u8003 horizon_plugin_pytorch \u5FEB\u901F\u5165\u95E8\u7AE0\u8282\u4E2D\u7684 ",(0,s.jsx)(e.a,{href:"/3.0.22/zh/guide/plugin/qat_quickstart/qat_quickstart.html#calibration",children:"Calibration"})," \u5C0F\u8282\u5185\u5BB9\u3002\u4F7F\u7528 ",(0,s.jsx)(e.code,{children:"prepare"})," \u65B9\u6CD5\u8F6C\u5316\u6D6E\u70B9\u6A21\u578B\u524D\uFF0C\u9700\u8981\u4E3A\u6A21\u578B\u914D\u7F6E ",(0,s.jsx)(e.code,{children:"qconfig"}),"\uFF0C\u53C2\u8003 ",(0,s.jsx)(e.a,{href:"/3.0.22/zh/guide/plugin/user_guide/qconfig.html",children:"QConfig \u8BE6\u89E3"})," \u5C0F\u8282\u7684\u5185\u5BB9\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u8BBE\u7F6E ",(0,s.jsx)(e.code,{children:"fake quantize"})," \u72B6\u6001\u4E3A ",(0,s.jsx)(e.code,{children:"CALIBRATION"})," \u3002"]}),"\n",(0,s.jsx)(e.pre,{className:"code",children:(0,s.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,s.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,s.jsxs)(e.span,{className:"line line-number",children:[(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"horizon"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"set_fake_quantize"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(model, horizon.quantization.FakeQuantState.CALIBRATION)"})]}),"\n"]})})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"fake quantize"})," \u4E00\u5171\u6709\u4E09\u79CD\u72B6\u6001\uFF0C\u5206\u522B\u9700\u8981\u5728 ",(0,s.jsx)(e.code,{children:"QAT"})," \u3001 ",(0,s.jsx)(e.code,{children:"calibration"})," \u3001 ",(0,s.jsx)(e.code,{children:"validation"})," \u524D\u5C06\u6A21\u578B\u7684 ",(0,s.jsx)(e.code,{children:"fake quantize"})," \u8BBE\u7F6E\u4E3A\u5BF9\u5E94\u7684\u72B6\u6001\u3002\u5728 calibration \u72B6\u6001\u4E0B\uFF0C\u4EC5\u89C2\u6D4B\u5404\u7B97\u5B50\u8F93\u5165\u8F93\u51FA\u7684\u7EDF\u8BA1\u91CF\u3002\u5728 QAT \u72B6\u6001\u4E0B\uFF0C\u9664\u89C2\u6D4B\u7EDF\u8BA1\u91CF\u5916\u8FD8\u4F1A\u8FDB\u884C\u4F2A\u91CF\u5316\u64CD\u4F5C\u3002\u800C\u5728 validation \u72B6\u6001\u4E0B\uFF0C\u4E0D\u4F1A\u89C2\u6D4B\u7EDF\u8BA1\u91CF\uFF0C\u4EC5\u8FDB\u884C\u4F2A\u91CF\u5316\u64CD\u4F5C\u3002"]}),"\n",(0,s.jsx)(e.pre,{className:"code",children:(0,s.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,s.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,s.jsxs)(e.span,{className:"line line-number",children:[(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"FakeQuantState"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Enum"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"):"})]}),"\n",(0,s.jsxs)(e.span,{className:"line line-number",children:[(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    QAT "}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"qat"'})]}),"\n",(0,s.jsxs)(e.span,{className:"line line-number",children:[(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    CALIBRATION "}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"calibration"'})]}),"\n",(0,s.jsxs)(e.span,{className:"line line-number",children:[(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    VALIDATION "}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"validation"'})]}),"\n"]})})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"calibration\u3002\u628A\u51C6\u5907\u597D\u7684\u6821\u51C6\u6570\u636E\u5582\u7ED9\u6A21\u578B\uFF0C\u6A21\u578B\u5728 forward \u8FC7\u7A0B\u4E2D\u7531 observer \u89C2\u6D4B\u76F8\u5173\u7EDF\u8BA1\u91CF\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u8BBE\u7F6E\u6A21\u578B\u72B6\u6001\u4E3A eval \u5E76\u8BBE\u7F6E ",(0,s.jsx)(e.code,{children:"fake quantize"})," \u72B6\u6001\u4E3A ",(0,s.jsx)(e.code,{children:"VALIDATION"})," \u3002"]}),"\n",(0,s.jsx)(e.pre,{className:"code",children:(0,s.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,s.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,s.jsxs)(e.span,{className:"line line-number",children:[(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"model"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"eval"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,s.jsxs)(e.span,{className:"line line-number",children:[(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"horizon"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"set_fake_quantize"}),(0,s.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(model, horizon.quantization.FakeQuantState.VALIDATION)"})]}),"\n"]})})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u9A8C\u8BC1 ",(0,s.jsx)(e.code,{children:"calibration"})," \u6548\u679C\u3002\u5982\u679C\u6548\u679C\u6EE1\u610F\uFF0C\u5219\u53EF\u4EE5\u76F4\u63A5\u5C06\u6A21\u578B\u8F6C\u4E3A\u5B9A\u70B9\u6216\u5728\u6B64\u57FA\u7840\u4E0A\u8FDB\u884C\u91CF\u5316\u611F\u77E5\u8BAD\u7EC3\uFF0C\u4E0D\u6EE1\u610F\u5219\u8C03\u6574 ",(0,s.jsx)(e.code,{children:"calibration qconfig"})," \u4E2D\u7684\u53C2\u6570\u7EE7\u7EED calibration\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"\u5E38\u7528\u7B97\u6CD5\u4ECB\u7ECD",children:[(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u5E38\u7528\u7B97\u6CD5\u4ECB\u7ECD",children:"#"}),"\u5E38\u7528\u7B97\u6CD5\u4ECB\u7ECD"]}),"\n",(0,s.jsxs)(e.div,{className:"rspress-directive info",children:[(0,s.jsx)(e.div,{className:"rspress-directive-title",children:"\u6CE8\u89E3"}),(0,s.jsx)(e.div,{className:"rspress-directive-content",children:(0,s.jsx)(e.p,{children:"\u6709\u5173\u6BCF\u4E2A\u7B97\u5B50\u7684\u53C2\u6570\u8BF4\u660E\uFF0C\u8BF7\u53C2\u8003\u6587\u672B API \u6587\u6863\u3002"})})]}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u7B97\u6CD5"}),(0,s.jsx)(e.th,{children:"\u901F\u5EA6\u6392\u540D"}),(0,s.jsx)(e.th,{children:"\u7CBE\u5EA6\u6392\u540D"}),(0,s.jsx)(e.th,{children:"\u6613\u7528\u6027\u6392\u540D"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"min_max"}),(0,s.jsx)(e.td,{children:"1"}),(0,s.jsx)(e.td,{children:"5"}),(0,s.jsx)(e.td,{children:"1"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"percentile"}),(0,s.jsx)(e.td,{children:"2"}),(0,s.jsx)(e.td,{children:"4"}),(0,s.jsx)(e.td,{children:"4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"mse"}),(0,s.jsx)(e.td,{children:"4"}),(0,s.jsx)(e.td,{children:"1"}),(0,s.jsx)(e.td,{children:"2"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"kl"}),(0,s.jsx)(e.td,{children:"5"}),(0,s.jsx)(e.td,{children:"2"}),(0,s.jsx)(e.td,{children:"3"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"mix"}),(0,s.jsx)(e.td,{children:"3"}),(0,s.jsx)(e.td,{children:"2"}),(0,s.jsx)(e.td,{children:"1"})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u5E38\u7528\u7684\u51E0\u79CD\u6821\u51C6\u65B9\u6CD5\u6027\u80FD\u5982\u4E0A\u8868\u6240\u793A\uFF0C\u6570\u5B57\u8D8A\u5C0F\u8D8A\u597D\uFF0C\u901F\u5EA6\u8868\u793A\u76F8\u540C\u6570\u636E\u6821\u51C6\u8017\u65F6\uFF0C\u7CBE\u5EA6\u8868\u793A\u8BE5\u65B9\u6CD5\u5728\u5927\u591A\u6570\u6A21\u578B\u4E0A\u7684\u6821\u51C6\u6548\u679C\uFF0C\u6613\u7528\u6027\u8868\u793A\u8BE5\u65B9\u6CD5\u7684\u8C03\u53C2\u590D\u6742\u5EA6\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5BF9\u4E8E\u540C\u4E00\u6A21\u578B\u800C\u8A00\uFF0C\u4E0D\u540C\u65B9\u6CD5\u4E0D\u540C\u53C2\u6570\u7684\u7CBE\u5EA6/\u901F\u5EA6\u4F1A\u5B58\u5728\u8F83\u5927\u5DEE\u522B\uFF0C\u6700\u65B0\u7684\u4E00\u4E9B\u7814\u7A76\u5DE5\u4F5C\u4E5F\u8868\u660E\uFF0C\u6CA1\u6709\u4E00\u79CD\u65B9\u6CD5\u53EF\u4EE5\u5728\u6240\u6709\u6A21\u578B\u4E0A\u90FD\u53D6\u5F97\u6700\u597D\u7684\u7CBE\u5EA6\uFF0C\u9700\u8981\u9488\u5BF9\u5730\u8C03\u6574\u5176\u53C2\u6570\u3002\u6240\u4EE5\u63A8\u8350\u60A8\u5BF9\u8FD9\u51E0\u79CD\u6821\u51C6\u65B9\u6CD5\u90FD\u8FDB\u884C\u5C1D\u8BD5\u3002"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"min_max\u3002\u6B64\u65B9\u6CD5\u4EC5\u7EDF\u8BA1\u6700\u5927\u503C\u6700\u5C0F\u503C\u7684\u6ED1\u52A8\u5E73\u5747\uFF0C\u7528\u4E8E\u5FEB\u901F\u786E\u5B9A Batch size\u3001average_constant \u7B49\u901A\u7528\u53C2\u6570\uFF0C\u6CA1\u6709\u592A\u591A\u6280\u5DE7\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"percentile\u3002\u6B64\u65B9\u6CD5\u662F\u6240\u6709\u65B9\u6CD5\u4E2D\u7CBE\u5EA6\u4E0A\u9650\u6700\u9AD8\u7684\uFF0C\u4F46\u4E5F\u662F\u8C03\u6574\u8D77\u6765\u6700\u9EBB\u70E6\u7684\uFF0C\u5982\u679C\u901A\u8FC7\u5176\u4ED6\u65B9\u6CD5\u6216\u672C\u65B9\u6CD5\u7684\u9ED8\u8BA4\u53C2\u6570\u5C31\u53EF\u4EE5\u6EE1\u8DB3\u7CBE\u5EA6\u8981\u6C42\uFF0C\u90A3\u4E48\u4E0D\u5EFA\u8BAE\u5728\u8C03\u53C2\u4E0A\u82B1\u592A\u591A\u65F6\u95F4\u3002percentile \u53EF\u8C03\u7684\u53C2\u6570\u4E00\u5171\u6709\u4E24\u4E2A bins\u3001percentile\u3002bins \u8D8A\u591A\uFF0Cmax \u7684\u5019\u9009\u9879\u95F4\u9694\u8D8A\u5C0F\uFF0C\u53EF\u4F9B\u8C03\u6574\u7684\u7C92\u5EA6\u8D8A\u7EC6\uFF0C\u4F46\u4E5F\u610F\u5473\u7740\u66F4\u9AD8\u7684\u8BA1\u7B97\u8017\u65F6\u3002\u5EFA\u8BAE\u5148\u786E\u5B9A percentile \u518D\u8C03\u6574 bins\uFF0C\u4E24\u8005\u4EA4\u66FF\u8FED\u4EE3\u7F29\u5C0F\u8C03\u53C2\u8303\u56F4\u76F4\u81F3\u8FBE\u5230\u6EE1\u610F\u7684\u6548\u679C\u3002\u7EDD\u5927\u90E8\u5206\u60C5\u51B5\u4E0B bins \u53D6 2048 \u63D0\u4F9B\u7684\u8C03\u6574\u7C92\u5EA6\u5B8C\u5168\u8DB3\u591F\uFF0C\u4E0D\u9700\u8981\u5355\u72EC\u8C03\u6574\u8FD9\u4E2A\u53C2\u6570\u3002\u4EE5\u4E0B\u662F\u4E00\u4E2A\u6A21\u578B\u7684\u8C03\u53C2\u8DEF\u5F84\uFF1A"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u987A\u5E8F"}),(0,s.jsx)(e.th,{children:"percentile"}),(0,s.jsx)(e.th,{children:"bins"}),(0,s.jsx)(e.th,{children:"\u7CBE\u5EA6"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"1"}),(0,s.jsx)(e.td,{children:"99.99"}),(0,s.jsx)(e.td,{children:"2048"}),(0,s.jsx)(e.td,{children:"53.75"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"2"}),(0,s.jsx)(e.td,{children:"99.99"}),(0,s.jsx)(e.td,{children:"4096"}),(0,s.jsx)(e.td,{children:"54.38"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"3"}),(0,s.jsx)(e.td,{children:"99.995"}),(0,s.jsx)(e.td,{children:"4096"}),(0,s.jsx)(e.td,{children:"16.25"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"4"}),(0,s.jsx)(e.td,{children:"99.985"}),(0,s.jsx)(e.td,{children:"4096"}),(0,s.jsx)(e.td,{children:"32.67"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"5"}),(0,s.jsx)(e.td,{children:"99.9875"}),(0,s.jsx)(e.td,{children:"4096"}),(0,s.jsx)(e.td,{children:"57.06"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"6"}),(0,s.jsx)(e.td,{children:"99.9875"}),(0,s.jsx)(e.td,{children:"8192"}),(0,s.jsx)(e.td,{children:"62.84"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7"}),(0,s.jsx)(e.td,{children:"99.98875"}),(0,s.jsx)(e.td,{children:"8192"}),(0,s.jsx)(e.td,{children:"57.62"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"8"}),(0,s.jsx)(e.td,{children:"99.988125"}),(0,s.jsx)(e.td,{children:"8192"}),(0,s.jsx)(e.td,{children:"63.15"})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u53EF\u4EE5\u770B\u5230\u4ED4\u7EC6\u8C03\u6574\u540E\uFF0C\u7CBE\u5EA6\u63D0\u5347\u4E86\u5927\u7EA6 10%\u3002\n\u6A21\u578B\u4E2D\u4E0D\u540C op \u7684\u8F93\u5165\u8F93\u51FA\u4E4B\u95F4\u5B58\u5728\u5F88\u5927\u5DEE\u5F02\uFF0C\u4E00\u7EC4\u5168\u5C40\u7684 percentile \u53C2\u6570\u53EF\u80FD\u5F88\u96BE\u6EE1\u8DB3\u6240\u6709 op \u7684\u9700\u6C42\uFF0C\u5BF9\u7CBE\u5EA6\u8981\u6C42\u8F83\u9AD8\u65F6\uFF0C\u53EF\u4EE5\u5148\u901A\u8FC7\u4E0A\u9762\u7684\u65B9\u6CD5\u627E\u5230\u8F83\u597D\u7684\u5168\u5C40\u53C2\u6570\uFF0C\u518D\u901A\u8FC7 debug \u5DE5\u5177\u627E\u5230\u8BEF\u5DEE\u8F83\u5927\u7684\u51E0\u4E2A op\uFF0C\u5355\u72EC\u4E3A\u8FD9\u51E0\u4E2A op \u8BBE\u7F6E percentile \u53C2\u6570\uFF0C\u8BBE\u7F6E\u65B9\u5F0F\u53C2\u7167 qconfig \u8BBE\u7F6E\u3002\u4E0B\u9762\u5217\u4E3E\u51E0\u79CD\u5E38\u89C1\u7684\u5BB9\u6613\u5BFC\u81F4\u8BEF\u5DEE\u8F83\u5927\u7684\u6570\u636E\u5206\u5E03\uFF1A"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"calibration_percentile_longtail",src:l})}),"\n",(0,s.jsx)(e.p,{children:"\u8D85\u957F\u5C3E\u5206\u5E03\uFF0Cpercentile \u7684\u53D6\u503C\u5E94\u5F53\u5C0F\u4E00\u4E9B\uFF0C\u56FE\u4E2D 99.9 \u662F\u8F83\u597D\u7684\u53D6\u503C\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"calibration_percentile_bimodal",src:c})}),"\n",(0,s.jsx)(e.p,{children:"\u503C\u57DF\u8FC7\u5927\uFF0C\u4E14\u5206\u5E03\u5E76\u4E0D\u96C6\u4E2D\u5728\u4E00\u5904\uFF0C\u8FD9\u79CD\u60C5\u51B5\u65E0\u8BBA\u662F\u4FDD\u7559\u5C3E\u90E8\u8FD8\u662F\u5FFD\u7565\u5C3E\u90E8\u90FD\u4F1A\u5E26\u6765\u8F83\u5927\u7684\u7CBE\u5EA6\u635F\u5931\uFF0C\u5E94\u8BE5\u5728\u8BAD\u7EC3\u6D6E\u70B9\u6A21\u578B\u65F6\u901A\u8FC7\u8C03\u6574 weight decay \u7B49\u53C2\u6570\u907F\u514D\u8FD9\u79CD\u60C5\u51B5\u7684\u51FA\u73B0\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"calibration_percentile_ln",src:a})}),"\n",(0,s.jsx)(e.p,{children:"layernorm \u7684\u8F93\u51FA\u5206\u5E03\u4F1A\u5448\u73B0\u51FA\u82E5\u5E72\u96C6\u4E2D\u5EA6\u975E\u5E38\u9AD8\u7684\u533A\u57DF\uFF0C\u6B64\u65F6 percentile \u6309\u7167\u6B63\u5E38\u65B9\u6CD5\u8C03\u6574\u5BF9\u4E8E\u91CF\u5316\u7ED3\u679C\u4E0D\u4F1A\u6709\u4EFB\u4F55\u5F71\u54CD\uFF0C\u9700\u8981\u5C06 percentile \u8C03\u6574\u5E45\u5EA6\u589E\u52A0\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"mse\u3002\u53EF\u8C03\u6574\u7684\u53C2\u6570\u53EA\u6709 stride\uFF0C\u9ED8\u8BA4 stride \u4E3A 1\uFF0C\u4F1A\u9010\u6B65\u5C1D\u8BD5\u6700\u5927\u503C\u7684 100 \u5206\u4F4D\u5E76\u9009\u51FA\u91CF\u5316\u53CD\u91CF\u5316\u524D\u540E\u8BEF\u5DEE\u6700\u5C0F\uFF08L2 \u8DDD\u79BB\uFF09\u7684\u5206\u4F4D\u5BF9\u5E94\u7684\u503C\u3002\u6B64\u65B9\u6CD5\u5BF9\u5927\u6A21\u578B\u8017\u65F6\u8F83\u9AD8\uFF0C\u5728\u5408\u7406\u8303\u56F4\u5185\u8C03\u5927 stride \u53EF\u4EE5\u5728\u4FDD\u8BC1\u7CBE\u5EA6\u7684\u524D\u63D0\u4E0B\u51CF\u5C11\u8017\u65F6\uFF0Cstride \u8C03\u6574\u8FC7\u5927\u4F1A\u5F71\u54CD\u7CBE\u5EA6\u3002\u6CE8\u610F\uFF0C\u8C03\u6574\u6B64\u65B9\u6CD5\u7684\u53C2\u6570\u53EA\u80FD\u4F18\u5316\u8017\u65F6\uFF0C\u5E76\u4E0D\u80FD\u663E\u8457\u63D0\u5347\u7CBE\u5EA6\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"kl\u3002\u53EF\u8C03\u7684\u53C2\u6570\u4E00\u5171\u6709\u4E24\u4E2A\uFF0Cbin \u548C update_interval\u3002\u7531\u4E8E\u6B64\u65B9\u6CD5\u8017\u65F6\u8FC7\u957F\uFF0C\u4E0D\u5EFA\u8BAE\u8C03\u6574\u9ED8\u8BA4 bin\uFF0Cupdate_interval \u9ED8\u8BA4\u4E3A 1\uFF0C\u8C03\u5927\u53EF\u4EE5\u51CF\u5C11\u8017\u65F6\uFF0C\u4F46\u9700\u8981\u4FDD\u8BC1 update_interval \u5C0F\u4E8E\u603B\u7684 calibration step\uFF0C\u5426\u5219\u65E0\u6CD5\u5F97\u5230\u6B63\u5E38\u7684\u91CF\u5316\u53C2\u6570\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"mix\u3002\u6B64\u65B9\u6CD5\u4E3A\u6DF7\u5408\u6821\u51C6\uFF0C\u5BF9\u4E8E\u6BCF\u4E00\u4E2A\u9700\u8981\u7EDF\u8BA1\u7684\u5730\u65B9\uFF0C\u90FD\u4F1A\u5C1D\u8BD5 percentile \u65B9\u6CD5\u7684\u4E0D\u540C\u53C2\u6570\uFF0C\u9009\u51FA\u91CF\u5316\u53CD\u91CF\u5316\u524D\u540E\u8BEF\u5DEE\u6700\u5C0F\uFF08L2 \u8DDD\u79BB\uFF09\u7684\u65B9\u6CD5\u3002\u81EA\u52A8\u5316\u7A0B\u5EA6\u8F83\u9AD8\uFF0C\u6CA1\u6709\u9700\u8981\u8C03\u6574\u7684\u53C2\u6570\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"\u8C03\u53C2\u6280\u5DE7",children:[(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u8C03\u53C2\u6280\u5DE7",children:"#"}),"\u8C03\u53C2\u6280\u5DE7"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"calibration \u6570\u636E\u8D8A\u591A\u8D8A\u597D\uFF0C\u4F46\u56E0\u4E3A\u8FB9\u9645\u6548\u5E94\u7684\u5B58\u5728\uFF0C\u5F53\u6570\u636E\u91CF\u5927\u5230\u4E00\u5B9A\u7A0B\u5EA6\u540E\uFF0C\u5BF9\u7CBE\u5EA6\u7684\u63D0\u5347\u5C06\u975E\u5E38\u6709\u9650\u3002\u5982\u679C\u8BAD\u7EC3\u96C6\u8F83\u5C0F\uFF0C\u53EF\u4EE5\u5168\u90E8\u7528\u6765 calibration\uFF0C\u5982\u679C\u8BAD\u7EC3\u96C6\u8F83\u5927\uFF0C\u53EF\u4EE5\u7ED3\u5408 calibration \u8017\u65F6\u6311\u9009\u5927\u5C0F\u5408\u9002\u7684\u5B50\u96C6\uFF0C\u5EFA\u8BAE\u81F3\u5C11\u8FDB\u884C 10 - 100 \u4E2A step \u7684\u6821\u51C6\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u6570\u636E\u53EF\u4EE5\u505A\u6C34\u5E73\u7FFB\u8F6C\u8FD9\u7C7B augmentation\uFF0C\u4E0D\u8981\u505A\u9A6C\u8D5B\u514B\u8FD9\u79CD augmentation\u3002\u5C3D\u91CF\u4F7F\u7528 infer \u9636\u6BB5\u7684\u524D\u5904\u7406 + \u8BAD\u7EC3\u6570\u636E\u8FDB\u884C\u6821\u51C6\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"Batch size \u5C3D\u53EF\u80FD\u5927\uFF0C\u5982\u679C\u6570\u636E\u566A\u58F0\u8F83\u5927\u6216\u6A21\u578B\u79BB\u7FA4\u70B9\u8F83\u591A\uFF0C\u53EF\u4EE5\u9002\u5F53\u51CF\u5C0F\u3002\u6B64\u53C2\u6570\u5E94\u5F53\u5728\u5C1D\u8BD5 min max \u65B9\u6CD5\u65F6\u786E\u5B9A\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"average_constant \u8868\u793A\u6BCF\u4E2A step \u5BF9\u6700\u5927\u503C\u6700\u5C0F\u503C\u7684\u5F71\u54CD\uFF0Caverage_constant \u8D8A\u5C0F\uFF0C\u5F53\u524D step \u7684\u5F71\u54CD\u8D8A\u5C0F\uFF0C\u5386\u53F2\u6ED1\u52A8\u5747\u503C\u7684\u5F71\u54CD\u8D8A\u5927\u3002\u8BE5\u53C2\u6570\u9700\u8981\u7ED3\u5408\u6570\u636E\u91CF\u5728 0.01 ~ 0.5 \u4E4B\u95F4\u8C03\u6574\u3002\u5F53\u6570\u636E\u91CF\u5145\u8DB3\u65F6\uFF08step > 100\uFF09\uFF0Caverage_constant \u53D6 0.01\uFF0C\u6570\u636E\u91CF\u4E0D\u8DB3\u65F6\uFF0Caverage_constant \u914C\u60C5\u589E\u52A0\uFF0C\u6781\u7AEF\u60C5\u51B5\u4E0B\uFF0C\u53EA\u6709 2 \u4E2A step \u7684\u6570\u636E\uFF0Caverage_constant \u53D6 0.5\u3002\u6B64\u53C2\u6570\u5E94\u5F53\u5728\u5C1D\u8BD5 min max \u65B9\u6CD5\u65F6\u786E\u5B9A\uFF0C\u4E4B\u540E\u5176\u4ED6\u65B9\u6CD5\u90FD\u6CBF\u7528\u6B64\u53C2\u6570\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"calibration \u6A21\u578B\u7CBE\u5EA6\u8F83\u597D\u65F6\uFF0C\u56FA\u5B9A feature map \u7684\u91CF\u5316\u53C2\u6570\u8FDB\u884C QAT \u8BAD\u7EC3\u53EF\u4EE5\u53D6\u5F97\u66F4\u597D\u7684\u6548\u679C\uFF0C\u7CBE\u5EA6\u8F83\u5DEE\u65F6\uFF0C\u5219\u4E0D\u80FD\u56FA\u5B9A calibration \u5F97\u5230\u7684\u91CF\u5316\u53C2\u6570\u3002\u5173\u4E8E\u7CBE\u5EA6\u662F\u597D\u8FD8\u662F\u574F\uFF0C\u6CA1\u6709\u660E\u786E\u7684\u6807\u51C6\uFF0C\u9700\u8981\u53BB\u5C1D\u8BD5\u3002\u6BD4\u5982\uFF1A\u67D0\u6A21\u578B\u7CBE\u5EA6\u4E3A 100\uFF0C\u5982\u679C calibration  \u7CBE\u5EA6\u4E3A 50\uFF0C\u90A3\u4E48\u7CBE\u5EA6\u80AF\u5B9A\u79F0\u4E0D\u4E0A\u597D\uFF0C\u4F46\u5982\u679C calibration \u7CBE\u5EA6\u4E3A 95\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u7CBE\u5EA6\u662F\u5426\u53EF\u4EE5\u8FBE\u5230\u56FA\u5B9A feature map \u91CF\u5316\u53C2\u6570\u7684\u7A0B\u5EA6\u5C31\u9700\u8981\u5C1D\u8BD5\u4E86\uFF0C\u901A\u5E38\u505A\u6CD5\u662F\u56FA\u5B9A\u4E0E\u4E0D\u56FA\u5B9A\u90FD\u505A\u5B9E\u9A8C\u8FDB\u884C\u5BF9\u6BD4\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4F18\u5148\u5C1D\u8BD5 min max \u65B9\u6CD5\uFF0C\u8BE5\u65B9\u6CD5\u662F\u901F\u5EA6\u6700\u5FEB\u7684\uFF0C\u7528\u6765\u8DD1\u901A calibration \u6D41\u7A0B\uFF0C\u8C03\u6574\u5E76\u786E\u5B9A batch size \u548C average_constant \u4E24\u4E2A\u53C2\u6570\uFF0C\u63A5\u7740\u5206\u522B\u5C1D\u8BD5 percentile\u3001kl\u3001mse \u548C mix \u56DB\u79CD\u65B9\u6CD5\u5E76\u9009\u53D6\u6548\u679C\u6700\u597D\u7684\u65B9\u6CD5\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"observer-\u53C2\u6570\u6587\u6863",children:[(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#observer-\u53C2\u6570\u6587\u6863",children:"#"}),"Observer \u53C2\u6570\u6587\u6863"]}),"\n",(0,s.jsx)("a",{id:"module-horizon_plugin_pytorch.quantization.observer_v2"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.em,{children:"class"})," horizon_plugin_pytorch.quantization.observer_v2.KLObserver (bins: int = 512, update_interval: int = 1, averaging_constant: float = 0.01, ch_axis: int = -1, dtype: dtype | QuantDType = 'qint8', qscheme: qscheme = torch.per_tensor_symmetric, quant_min: int | None = None, quant_max: int | None = None, is_sync_quantize: bool = False, factory_kwargs: Dict | None = None)"]})}),"\n",(0,s.jsx)(e.p,{children:"KL observer."}),"\n",(0,s.jsx)(e.p,{children:"KL observer based on histogram. Histogram is calculated online\nand won\u2019t be saved."}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"bins"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Number of histograms bins."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"update_interval"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Interval of computing KL entropy and update min/max.\nKLObserver will constantly collect histograms of activations,\nbut only perform KL calculation when update_interval is satisfied.\nif it is set to 1, KL entropy will be computed every forward step.\nLarger interval guarantees less time and does no harm to\ncalibration accuracy. Set it to the total calibration steps can\nachieve best performance. update_interval must be no greater than\ntotal calibration steps, otherwise no min/max will be computed."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"averaging_constant"})," (",(0,s.jsx)(e.code,{children:"float"}),") \u2013 Averaging constant for min/max."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ch_axis"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Channel axis."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"dtype"})," (",(0,s.jsx)(e.code,{children:"Union"}),"[",(0,s.jsx)(e.code,{children:"dtype"}),", ",(0,s.jsx)(e.code,{children:"QuantDType"}),"]) \u2013 Quantized data type."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"qscheme"})," (",(0,s.jsx)(e.code,{children:"qscheme"}),") \u2013 Quantization scheme to be used."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_min"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Min quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_max"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Max quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"is_sync_quantize"})," (",(0,s.jsx)(e.code,{children:"bool"}),") \u2013 If sync statistics when training with multiple\ndevices."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"factory_kwargs"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"Dict"}),"]) \u2013 kwargs which are passed to factory functions for\nmin_val and max_val."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"forward (x_orig)"})}),"\n",(0,s.jsx)(e.p,{children:"Defines the computation performed at every call."}),"\n",(0,s.jsx)(e.p,{children:"Should be overridden by all subclasses."}),"\n",(0,s.jsxs)(e.p,{children:["NOTE:\nAlthough the recipe for forward pass needs to be defined within\nthis function, one should call the ",(0,s.jsx)(e.code,{children:"Module"})," instance afterwards\ninstead of this since the former takes care of running the\nregistered hooks while the latter silently ignores them."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.em,{children:"class"})," horizon_plugin_pytorch.quantization.observer_v2.MSEObserver (stride: int = 1, averaging_constant: float = 0.01, ch_axis: int = -1, dtype: dtype | QuantDType = 'qint8', qscheme: qscheme = torch.per_tensor_symmetric, quant_min: int | None = None, quant_max: int | None = None, is_sync_quantize: bool = False, factory_kwargs: Dict | None = None)"]})}),"\n",(0,s.jsx)(e.p,{children:"MSE observer."}),"\n",(0,s.jsx)(e.p,{children:"Observer module for computing the quantization parameters based on the\nMean Square Error (MSE) between the original tensor and the quantized one."}),"\n",(0,s.jsx)(e.p,{children:"This observer linear searches the quantization scales that minimize MSE."}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"stride"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Searching stride. Larger value gives smaller search space,\nwhich means less computing time but possibly poorer accuracy.\nDefault is 1. Suggests no greater than 20."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"averaging_constant"})," (",(0,s.jsx)(e.code,{children:"float"}),") \u2013 Averaging constant for min/max."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ch_axis"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Channel axis."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"dtype"})," (",(0,s.jsx)(e.code,{children:"Union"}),"[",(0,s.jsx)(e.code,{children:"dtype"}),", ",(0,s.jsx)(e.code,{children:"QuantDType"}),"]) \u2013 Quantized data type."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"qscheme"})," (",(0,s.jsx)(e.code,{children:"qscheme"}),") \u2013 Quantization scheme to be used."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_min"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Min quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_max"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Max quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"is_sync_quantize"})," (",(0,s.jsx)(e.code,{children:"bool"}),") \u2013 If sync statistics when training with multiple\ndevices."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"factory_kwargs"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"Dict"}),"]) \u2013 kwargs which are passed to factory functions for\nmin_val and max_val."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"forward (x_orig)"})}),"\n",(0,s.jsx)(e.p,{children:"Defines the computation performed at every call."}),"\n",(0,s.jsx)(e.p,{children:"Should be overridden by all subclasses."}),"\n",(0,s.jsxs)(e.p,{children:["NOTE:\nAlthough the recipe for forward pass needs to be defined within\nthis function, one should call the ",(0,s.jsx)(e.code,{children:"Module"})," instance afterwards\ninstead of this since the former takes care of running the\nregistered hooks while the latter silently ignores them."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.em,{children:"class"})," horizon_plugin_pytorch.quantization.observer_v2.MinMaxObserver (averaging_constant: float = 0.01, ch_axis: int = -1, dtype: dtype | QuantDType = 'qint8', qscheme: qscheme = torch.per_tensor_symmetric, quant_min: int | None = None, quant_max: int | None = None, is_sync_quantize: bool = False, factory_kwargs: Dict | None = None)"]})}),"\n",(0,s.jsx)(e.p,{children:"Min max observer."}),"\n",(0,s.jsx)(e.p,{children:"This observer computes the quantization parameters based on minimums and\nmaximums of the incoming tensors. The module records the moving average\nminimum and maximum of incoming tensors, and uses this statistic to compute\nthe quantization parameters."}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"averaging_constant"})," (",(0,s.jsx)(e.code,{children:"float"}),") \u2013 Averaging constant for min/max."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ch_axis"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Channel axis."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"dtype"})," (",(0,s.jsx)(e.code,{children:"Union"}),"[",(0,s.jsx)(e.code,{children:"dtype"}),", ",(0,s.jsx)(e.code,{children:"QuantDType"}),"]) \u2013 Quantized data type."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"qscheme"})," (",(0,s.jsx)(e.code,{children:"qscheme"}),") \u2013 Quantization scheme to be used."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_min"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Min quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_max"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Max quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"is_sync_quantize"})," (",(0,s.jsx)(e.code,{children:"bool"}),") \u2013 If sync statistics when training with multiple\ndevices."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"factory_kwargs"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"Dict"}),"]) \u2013 kwargs which are passed to factory functions for\nmin_val and max_val."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"forward (x_orig)"})}),"\n",(0,s.jsxs)(e.p,{children:["Record the running minimum and maximum of ",(0,s.jsx)(e.code,{children:"x"}),"."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.em,{children:"class"})," horizon_plugin_pytorch.quantization.observer_v2.MixObserver (averaging_constant: float = 0.01, ch_axis: int = -1, dtype: dtype | QuantDType = 'qint8', qscheme: qscheme = torch.per_tensor_symmetric, quant_min: int | None = None, quant_max: int | None = None, is_sync_quantize: bool = False, factory_kwargs: Dict | None = None)"]})}),"\n",(0,s.jsx)(e.p,{children:"Mix observer."}),"\n",(0,s.jsx)(e.p,{children:"This observer computes the quantization parameters based on multiple\ncalibration methods and selects the quantization parameters with the\nsmallest quantization error."}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"averaging_constant"})," (",(0,s.jsx)(e.code,{children:"float"}),") \u2013 Averaging constant for min/max."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ch_axis"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Channel axis."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"dtype"})," (",(0,s.jsx)(e.code,{children:"Union"}),"[",(0,s.jsx)(e.code,{children:"dtype"}),", ",(0,s.jsx)(e.code,{children:"QuantDType"}),"]) \u2013 Quantized data type."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"qscheme"})," (",(0,s.jsx)(e.code,{children:"qscheme"}),") \u2013 Quantization scheme to be used."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_min"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Min quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_max"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Max quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"is_sync_quantize"})," (",(0,s.jsx)(e.code,{children:"bool"}),") \u2013 If sync statistics when training with multiple\ndevices."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"factory_kwargs"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"Dict"}),"]) \u2013 kwargs which are passed to factory functions for\nmin_val and max_val."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"forward (x_orig)"})}),"\n",(0,s.jsx)(e.p,{children:"Defines the computation performed at every call."}),"\n",(0,s.jsx)(e.p,{children:"Should be overridden by all subclasses."}),"\n",(0,s.jsxs)(e.p,{children:["NOTE:\nAlthough the recipe for forward pass needs to be defined within\nthis function, one should call the ",(0,s.jsx)(e.code,{children:"Module"})," instance afterwards\ninstead of this since the former takes care of running the\nregistered hooks while the latter silently ignores them."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.em,{children:"class"})," horizon_plugin_pytorch.quantization.observer_v2.PercentileObserver (percentile: float = 99.99, bins: int = 2048, averaging_constant: float = 0.01, ch_axis: int = -1, dtype: dtype | QuantDType = 'qint8', qscheme: qscheme = torch.per_tensor_symmetric, quant_min: int | None = None, quant_max: int | None = None, is_sync_quantize: bool = False, factory_kwargs: Dict | None = None)"]})}),"\n",(0,s.jsx)(e.p,{children:"Percentile observer."}),"\n",(0,s.jsx)(e.p,{children:"Percentile observer based on histogram. Histogram is calculated online\nand won\u2019t be saved. The minimum and maximum are moving averaged to compute\nthe quantization parameters."}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"percentile"})," (",(0,s.jsx)(e.code,{children:"float"}),") \u2013 Index percentile of histrogram"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"bins"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Number of histograms bins."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"averaging_constant"})," (",(0,s.jsx)(e.code,{children:"float"}),") \u2013 Averaging constant for min/max."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ch_axis"})," (",(0,s.jsx)(e.code,{children:"int"}),") \u2013 Channel axis."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"dtype"})," (",(0,s.jsx)(e.code,{children:"Union"}),"[",(0,s.jsx)(e.code,{children:"dtype"}),", ",(0,s.jsx)(e.code,{children:"QuantDType"}),"]) \u2013 Quantized data type."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"qscheme"})," (",(0,s.jsx)(e.code,{children:"qscheme"}),") \u2013 Quantization scheme to be used."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_min"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Min quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_max"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"int"}),"]) \u2013 Max quantization value. Will follow dtype if unspecified."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"is_sync_quantize"})," (",(0,s.jsx)(e.code,{children:"bool"}),") \u2013 If sync statistics when training with multiple\ndevices."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"factory_kwargs"})," (",(0,s.jsx)(e.code,{children:"Optional"}),"[",(0,s.jsx)(e.code,{children:"Dict"}),"]) \u2013 kwargs which are passed to factory functions for\nmin_val and max_val."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"forward (x_orig)"})}),"\n",(0,s.jsx)(e.p,{children:"Defines the computation performed at every call."}),"\n",(0,s.jsx)(e.p,{children:"Should be overridden by all subclasses."}),"\n",(0,s.jsxs)(e.p,{children:["NOTE:\nAlthough the recipe for forward pass needs to be defined within\nthis function, one should call the ",(0,s.jsx)(e.code,{children:"Module"})," instance afterwards\ninstead of this since the former takes care of running the\nregistered hooks while the latter silently ignores them."]}),"\n",(0,s.jsx)("a",{id:"module-horizon_plugin_pytorch.quantization"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.em,{children:"class"})," horizon_plugin_pytorch.quantization.MovingAverageMinMaxObserver (averaging_constant=0.01, dtype=torch.qint8, qscheme=torch.per_tensor_symmetric, quant_min=None, quant_max=None, is_sync_quantize=False, factory_kwargs=None)"]})}),"\n",(0,s.jsx)(e.p,{children:"MovingAverageMinMax Observer."}),"\n",(0,s.jsx)(e.p,{children:"Observer module for computing the quantization parameters based on the\nmoving average of the min and max values."}),"\n",(0,s.jsx)(e.p,{children:"This observer computes the quantization parameters based on the moving\naverages of minimums and maximums of the incoming tensors. The module\nrecords the average minimum and maximum of incoming tensors, and uses this\nstatistic to compute the quantization parameters."}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"averaging_constant"})," \u2013 Averaging constant for min/max."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"dtype"})," \u2013 Quantized data type"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"qscheme"})," \u2013 Quantization scheme to be used, only support\nper_tensor_symmetric scheme"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"reduce_range"})," \u2013 Reduces the range of the quantized data type by 1 bit"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_min"})," \u2013 Minimum quantization value."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_max"})," \u2013 Maximum quantization value."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"is_sync_quantize"})," \u2013 Whether use sync quantize"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"factory_kwargs"})," \u2013 Arguments for register data buffer"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"forward (x_orig)"})}),"\n",(0,s.jsxs)(e.p,{children:["Record the running minimum and maximum of ",(0,s.jsx)(e.code,{children:"x"}),"."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.em,{children:"class"})," horizon_plugin_pytorch.quantization.MovingAveragePerChannelMinMaxObserver (averaging_constant=0.01, ch_axis=0, dtype=torch.qint8, qscheme=torch.per_channel_symmetric, quant_min=None, quant_max=None, is_sync_quantize=False, factory_kwargs=None)"]})}),"\n",(0,s.jsx)(e.p,{children:"MovingAveragePerChannelMinMax Observer."}),"\n",(0,s.jsx)(e.p,{children:"Observer module for computing the quantization parameters based on the\nrunning per channel min and max values."}),"\n",(0,s.jsx)(e.p,{children:"This observer uses the tensor min/max statistics to compute the per channel\nquantization parameters. The module records the running minimum and maximum\nof incoming tensors, and uses this statistic to compute the quantization\nparameters."}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"averaging_constant"})," \u2013 Averaging constant for min/max."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ch_axis"})," \u2013 Channel axis"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"dtype"})," \u2013 Quantized data type"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"qscheme"})," \u2013 Quantization scheme to be used, Only support\nper_channel_symmetric"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_min"})," \u2013 Minimum quantization value."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"quant_max"})," \u2013 Maximum quantization value."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"is_sync_quantize"})," \u2013 whether use sync quantize"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"factory_kwargs"})," \u2013 Arguments for register data buffer"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"forward (x_orig)"})}),"\n",(0,s.jsx)(e.p,{children:"Defines the computation performed at every call."}),"\n",(0,s.jsx)(e.p,{children:"Should be overridden by all subclasses."}),"\n",(0,s.jsxs)(e.p,{children:["NOTE:\nAlthough the recipe for forward pass needs to be defined within\nthis function, one should call the ",(0,s.jsx)(e.code,{children:"Module"})," instance afterwards\ninstead of this since the former takes care of running the\nregistered hooks while the latter silently ignores them."]})]})}function h(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,r.ah)(),n.components);return e?(0,s.jsx)(e,Object.assign({},n,{children:(0,s.jsx)(d,n)})):d(n)}e.default=h,h.__RSPRESS_PAGE_META={},h.__RSPRESS_PAGE_META["3.0.22%2Fzh%2Fguide%2Fplugin%2Fuser_guide%2Fcalibration.mdx"]={toc:[{id:"\u6D41\u7A0B\u548C\u793A\u4F8B",text:"\u6D41\u7A0B\u548C\u793A\u4F8B",depth:2},{id:"\u5E38\u7528\u7B97\u6CD5\u4ECB\u7ECD",text:"\u5E38\u7528\u7B97\u6CD5\u4ECB\u7ECD",depth:2},{id:"\u8C03\u53C2\u6280\u5DE7",text:"\u8C03\u53C2\u6280\u5DE7",depth:2},{id:"observer-\u53C2\u6570\u6587\u6863",text:"Observer \u53C2\u6570\u6587\u6863",depth:2}],title:"Calibration \u6307\u5357",frontmatter:{}}},95895:function(n,e,i){i(39710);var s=i(85893),r=i(67294),t=i(45687);i(20388);let l={"zh-CN":n=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${n.minutes>=1?`${Math.ceil(n.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":n=>`Estimated reading time: ${n.minutes>=1?`${Math.ceil(n.minutes)} minutes`:"less than 1 minute"}`};function c(n,e,i){let s=Object.keys(l).includes(e)?e:i;return l[s](n)}e.Z=n=>{let{defaultLocale:e="en-US"}=n,i=(0,t.Vi)().page.readingTimeData,l=(0,t.Jr)(),a=(0,t.e7)(),[o,d]=(0,r.useState)(c(i,l,e));return(0,r.useEffect)(()=>{d(c(i,l,e))},[l,i]),(0,s.jsx)("span",{"data-dark":String(a),className:"rp-reading-time",children:o})}}}]);