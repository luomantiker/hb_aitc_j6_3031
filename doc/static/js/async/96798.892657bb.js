"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["96798"],{69083:function(n,e,s){s.r(e);var i=s(85893),l=s(50065),r=s(95895);function o(n){let e=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",ul:"ul",li:"li",code:"code",pre:"pre",span:"span"},(0,l.ah)(),n.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.h1,{id:"eager-\u6A21\u5F0F",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#eager-\u6A21\u5F0F",children:"#"}),"Eager \u6A21\u5F0F"]}),"\n",(0,i.jsx)(r.Z,{}),"\n",(0,i.jsxs)(e.p,{children:["horizon_plugin_pytorch \u76EE\u524D\u652F\u6301\u91C7\u7528 eager \u6A21\u5F0F\u8FDB\u884C\u91CF\u5316\uFF0C\u4F46\u662F\uFF0C\u6211\u4EEC\u5DF2\u7ECF\u4E0D\u63A8\u8350\u518D\u4F7F\u7528\u8BE5\u6A21\u5F0F\u3002\nEager \u6A21\u5F0F\u7684\u6574\u4F53\u6D41\u7A0B\u540C\u6837\u53C2\u8003\u4E86 PyTorch \u5B98\u65B9\u7684\u91CF\u5316\u63A5\u53E3\u548C\u601D\u8DEF\uFF0C\u56E0\u6B64\uFF0C\u5EFA\u8BAE\u60A8\u5148\u9605\u8BFB ",(0,i.jsx)(e.a,{href:"https://pytorch.org/docs/stable/quantization.html#quantization",target:"_blank",rel:"noopener noreferrer",children:"PyTorch \u5B98\u65B9\u6587\u6863"}),"\u4E2D Eager \u6A21\u5F0F\u76F8\u5173\u90E8\u5206\u3002"]}),"\n",(0,i.jsxs)(e.h2,{id:"\u4E0E-fx-\u6A21\u5F0F\u7684\u533A\u522B",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4E0E-fx-\u6A21\u5F0F\u7684\u533A\u522B",children:"#"}),"\u4E0E fx \u6A21\u5F0F\u7684\u533A\u522B"]}),"\n",(0,i.jsx)(e.p,{children:"\u5728 horizon_plugin_pytorch \u4E2D\u4F7F\u7528 eager \u6A21\u5F0F\uFF0C\u548C fx \u6A21\u5F0F\u7684\u4E3B\u8981\u533A\u522B\u5728\u4E8E\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"eager \u6A21\u5F0F\u4EC5\u652F\u6301 module \u5F62\u5F0F\u7684\u7B97\u5B50\u3002\u5728\u6267\u884C\u91CF\u5316\u6D41\u7A0B\u524D\uFF0C\u60A8\u9700\u8981\u624B\u52A8\u5C06\u6D6E\u70B9\u6A21\u578B\u4E2D\u7684\u51FD\u6570\u5F62\u5F0F\u7684\u7B97\u5B50\u66FF\u6362\u4E3A PyTorch \u4E2D Module \u7C7B\u578B\u7684\u7B97\u5B50\u6216\u8005\u662F horizon_plugin_pytorch \u4E2D\u5B9A\u4E49\u7684\u4E13\u6709\u7B97\u5B50\uFF0C\u5305\u62EC\u4F46\u4E0D\u9650\u4E8E\uFF1A"}),"\n"]}),"\n",(0,i.jsxs)("table",{children:[(0,i.jsxs)("colgroup",{children:[(0,i.jsx)("col",{style:{width:"30%"}}),(0,i.jsx)("col",{style:{width:"70%"}})]}),(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)("b",{children:"\u539F\u59CB\u7684\u6D6E\u70B9\u7B97\u5B50"})}),(0,i.jsx)("td",{children:(0,i.jsx)("b",{children:"\u9700\u8981\u66FF\u6362\u7684\u7B97\u5B50"})})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"torch.nn.functional.relu"}),(0,i.jsx)("td",{children:"torch.nn.ReLU()"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["a + b / ",(0,i.jsx)("br",{})," torch.add"]}),(0,i.jsx)("td",{children:"horizon.nn.quantized.FloatFunctional().add"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Tensor.exp"}),(0,i.jsx)("td",{children:"horizon.nn.Exp()"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"torch.nn.functional.interpolate"}),(0,i.jsx)("td",{children:"horizon.nn.Interpolate()"})]})]})]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u60A8\u5FC5\u987B\u624B\u52A8\u5B9A\u4E49\u9700\u8981\u878D\u5408\u7684\u7B97\u5B50\uFF0C\u5E76\u5728\u6267\u884C\u91CF\u5316\u6D41\u7A0B\u524D\u663E\u5F0F\u8C03\u7528\u878D\u5408\u51FD\u6570\u6267\u884C\u7B97\u5B50\u878D\u5408\uFF0C\u8C03\u7528\u65F6\u4E5F\u9700\u6307\u5B9A\u4F7F\u7528 horizon_plugin_pytorch \u4E2D\u63D0\u4F9B\u7684 ",(0,i.jsx)(e.code,{children:"fuser_func"}),"\u3002\u5982\u4E0B\u6240\u793A\uFF1A"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{className:"code",children:(0,i.jsx)(e.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(e.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" torch "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" nn"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" horizon_plugin_pytorch "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" horizon"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ConvBNReLU"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"nn"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Sequential"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"):"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"__init__"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"self"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"in_channels"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"out_channels"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"kernel_size"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"):"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"super"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(ConvBNReLU, self)."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"__init__"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            nn."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Conv2d"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            in_channels"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"in_channels,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            out_channels"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"out_channels,"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            kernel_size"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"kernel_size"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            ),"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            nn."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BatchNorm2d"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(num_features"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"out_channels),"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            nn."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ReLU"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        )"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u6307\u5B9A\u53EF\u4EE5 fuse \u7684\u7B97\u5B50"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fuse_model"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"self"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"):"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        torch"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"quantization"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fuse_modules"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            self,"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            ["}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'0'"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'1'"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'2'"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"],"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            inplace"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u6307\u5B9A horizon_plugin_pytorch \u4E2D\u63D0\u4F9B\u7684 fuse \u51FD\u6570"})]}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"            fuser_func"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"horizon.quantization.fuse_known_modules,"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"        )"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"float_model "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ConvBNReLU"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# \u9700\u8981\u663E\u5F0F\u8C03\u7528 fuse \u51FD\u6570"})}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"float_model"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"fuse_model"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"()"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number"}),"\n",(0,i.jsxs)(e.span,{className:"line line-number",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"print"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(float_model)"})]}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# ConvBNReLU("})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (0): ConvReLU2d("})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (0): Conv2d(1, 1, kernel_size=(1, 1), stride=(1, 1))"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#     (1): ReLU()"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   )"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (1): Identity()"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"#   (2): Identity()"})}),"\n",(0,i.jsx)(e.span,{className:"line line-number",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# )"})}),"\n"]})})})]})}function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,l.ah)(),n.components);return e?(0,i.jsx)(e,Object.assign({},n,{children:(0,i.jsx)(o,n)})):o(n)}e.default=t,t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["3.0.22%2Fzh%2Fguide%2Fplugin%2Fadvanced_tutorial%2Feager.mdx"]={toc:[{id:"\u4E0E-fx-\u6A21\u5F0F\u7684\u533A\u522B",text:"\u4E0E fx \u6A21\u5F0F\u7684\u533A\u522B",depth:2}],title:"Eager \u6A21\u5F0F",frontmatter:{}}},95895:function(n,e,s){s(39710);var i=s(85893),l=s(67294),r=s(45687);s(20388);let o={"zh-CN":n=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${n.minutes>=1?`${Math.ceil(n.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":n=>`Estimated reading time: ${n.minutes>=1?`${Math.ceil(n.minutes)} minutes`:"less than 1 minute"}`};function t(n,e,s){let i=Object.keys(o).includes(e)?e:s;return o[i](n)}e.Z=n=>{let{defaultLocale:e="en-US"}=n,s=(0,r.Vi)().page.readingTimeData,o=(0,r.Jr)(),a=(0,r.e7)(),[c,h]=(0,l.useState)(t(s,o,e));return(0,l.useEffect)(()=>{h(t(s,o,e))},[o,s]),(0,i.jsx)("span",{"data-dark":String(a),className:"rp-reading-time",children:c})}}}]);