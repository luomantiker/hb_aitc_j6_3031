"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["18984"],{8136:function(e,n,s){s.r(n);var i=s(85893),o=s(50065),l=s(95895);function r(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",code:"code",pre:"pre",span:"span",ul:"ul",li:"li"},(0,o.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"model-compilation",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#model-compilation",children:"#"}),"Model Compilation"]}),"\n",(0,i.jsx)(l.Z,{}),"\n",(0,i.jsx)(n.p,{children:"HAT is capable of compiling fixed-point models to make the compiled Pytorch models suitable for on-board running. You can choose to compile the model as described in the next section."}),"\n",(0,i.jsxs)(n.h2,{id:"config-file-as-input",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#config-file-as-input",children:"#"}),"Config File as Input"]}),"\n",(0,i.jsxs)(n.p,{children:["This method uses the script ",(0,i.jsx)(n.code,{children:"tools/compile_perf_hbir.py"})," with the following command."]}),"\n",(0,i.jsx)(n.pre,{className:"code",children:(0,i.jsx)(n.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(n.code,{className:"language-bash",meta:"",children:[(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"python3"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"tools/compile_perf_hbir.py"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"-c"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"{"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"$CONFIG_FILE"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:"}"})]}),"\n"]})})}),"\n",(0,i.jsxs)(n.p,{children:["This command will get the compilation-related configurations from the ",(0,i.jsx)(n.code,{children:"hbir_compiler"})," field in the ",(0,i.jsx)(n.code,{children:"config"})," file, as illustrated by the following example:"]}),"\n",(0,i.jsx)(n.pre,{className:"code",children:(0,i.jsx)(n.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,i.jsxs)(n.code,{className:"language-python",meta:"",children:[(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" horizon_plugin_pytorch"})]}),"\n",(0,i.jsx)(n.span,{className:"line line-number"}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"hbir_compiler "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"dict"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    march"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"March.NASH_M,  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Options: NASH_E, NASH_M"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    opt"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:",  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Optimization level: 0, 1, 2 (from low to high)"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    jobs"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"32"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:",  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Multi-threaded compilation"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    debug"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:",  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Whether to enable debug mode"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    only_export"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"args.only_export,  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Whether to only export the pre-compiled HBIR"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    layer_details"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"True"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:",  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Whether to output performance details for each layer"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    input_source"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"["}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"pyramid"'}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"],  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Input source when deploying the model"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    model_path"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"./qat.bc"'}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:",  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Path to the QAT model"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    out_path"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"tmp_compile/model.hbm"'}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:",  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Path to the compiled model file"})]}),"\n",(0,i.jsxs)(n.span,{className:"line line-number",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:"    hbdk3_compatible_mode"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"False"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:",  "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"# Whether to compile in compatibility mode for HBM"})]}),"\n",(0,i.jsx)(n.span,{className:"line line-number",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})}),"\n"]})})}),"\n",(0,i.jsx)(n.p,{children:"When the compilation is complete, the following files are generated."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tmp_compile/model.hbm"}),": Compiled model file."]}),"\n"]})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,i.jsx)(n,Object.assign({},e,{children:(0,i.jsx)(r,e)})):r(e)}n.default=t,t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["3.0.22%2Fen%2Fguide%2Fadvanced_content%2Fhat%2Ftutorials%2Fcompile.mdx"]={toc:[{id:"config-file-as-input",text:"Config File as Input",depth:2}],title:"Model Compilation",frontmatter:{}}},95895:function(e,n,s){s(39710);var i=s(85893),o=s(67294),l=s(45687);s(20388);let r={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function t(e,n,s){let i=Object.keys(r).includes(n)?n:s;return r[i](e)}n.Z=e=>{let{defaultLocale:n="en-US"}=e,s=(0,l.Vi)().page.readingTimeData,r=(0,l.Jr)(),a=(0,l.e7)(),[c,h]=(0,o.useState)(t(s,r,n));return(0,o.useEffect)(()=>{h(t(s,r,n))},[r,s]),(0,i.jsx)("span",{"data-dark":String(a),className:"rp-reading-time",children:c})}}}]);