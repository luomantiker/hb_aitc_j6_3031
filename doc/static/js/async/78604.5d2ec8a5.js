"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["78604"],{40311:function(e,s,n){e.exports=n.p+"static/image/VP6_lkof_frame0.653a8f8c.jpg"},93454:function(e,s,n){e.exports=n.p+"static/image/VP6_lkof_framen.2f7d8878.jpg"},57464:function(e,s,n){e.exports=n.p+"static/image/VP6_lkof_sample.c24cd68e.png"},33859:function(e,s,n){n.r(s);var r=n(85893),l=n(50065),i=n(95895),o=n(57464),a=n(40311),t=n(93454);function c(e){let s=Object.assign({h1:"h1",a:"a",p:"p",code:"code",strong:"strong",img:"img",ol:"ol",li:"li",pre:"pre",span:"span",ul:"ul",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",div:"div"},(0,l.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.h1,{id:"optical-flow-sample",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#optical-flow-sample",children:"#"}),"Optical Flow Sample"]}),"\n",(0,r.jsx)(i.Z,{}),"\n",(0,r.jsxs)(s.p,{children:["The optical flow processing sample uses the ",(0,r.jsx)(s.code,{children:"hbVPPyrDown"}),", ",(0,r.jsx)(s.code,{children:"hbVPCornerHarris"})," and ",(0,r.jsx)(s.code,{children:"hbVPOpticalFlowPyrLK"})," interfaces. It shows how to perform optical flow tracking on consecutive frame images for detailed implementation, please compare the practice with the sample source code."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Function overview"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"image",src:o})}),"\n",(0,r.jsxs)(s.p,{children:["This sample realizes the function of feature point tracking on the image input of consecutive frames.\nThe input image is of NV12 type, which is converted to gray type and then used ",(0,r.jsx)(s.code,{children:"hbVPPyrDown"})," to generate 5 layers of pyramid layers.\nThe first frame uses ",(0,r.jsx)(s.code,{children:"hbVPCornerHarris"})," to generate harris corner points, and subsequent frames track the corner points generated in the first frame using ",(0,r.jsx)(s.code,{children:"hbVPOpticalFlowPyrLK"}),".\nEvery 5 frames ",(0,r.jsx)(s.code,{children:"hbVPCornerHarris"})," is called again to generate a priori eigenpoints to calibrate the tracking results."]}),"\n",(0,r.jsx)(s.p,{children:"The sample code process can be roughly divided into the following four steps, the detailed implementation of the sample source code please combine."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Allocate memory for input image and input-output feature points."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Prepare parameters for optical flow calculations."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"The computations for each frame are performed sequentially, including generation of pyramid layers, corner detection and optical flow tracking."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Release memory resources."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Operation guide"})}),"\n",(0,r.jsxs)(s.p,{children:["The optical flow processing sample execution script is located in the ",(0,r.jsx)(s.code,{children:"ucp_tutorial/vp/vp_samples/script/04_optical_flow"})," directory and contains the following script:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"04_optical_flow"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"README.md"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u2514\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"run_optical_flow.sh"})]}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"The command line in the run_optical_flow.sh script reads as follows:"}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-shell",meta:"",children:[(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"bin"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"../aarch64/bin/optical_flow_sample"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"lib"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"../aarch64/lib"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number"}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" LD_LIBRARY_PATH"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"${lib}"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"${LD_LIBRARY_PATH}"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" PATH"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"${bin}"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"${PATH}"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" HB_DSP_ENABLE_DIRECT_MODE"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"true"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" HB_DSP_ENABLE_CONFIG_VDSP"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"true"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" HB_DSP_LOG_LEVEL"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" HB_DSP_VDSP_LOG_LEVEL"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number"}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# Usage: ${bin} <image_file_list> <frame_num> <lkof_threshold> <harris_top_k>"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"${bin} ../../data/frame_images/images.list 10 5 5"})}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"The meanings of the command line parameters are as follows:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["$","{bin}",": Compiled executable file."]}),"\n",(0,r.jsx)(s.li,{children:"image_file_list: Input image list\u3002"}),"\n",(0,r.jsx)(s.li,{children:"frame_num: The number of running frames can be adjusted to the number of calculated frames according to the actual needs."}),"\n",(0,r.jsx)(s.li,{children:"lkof_threshold: Optical flow confidence threshold for filtering the results of optical flow calculations, user adjustable."}),"\n",(0,r.jsx)(s.li,{children:"harris_top_k: Filtering top k number results of corner point calculations, user adjustable."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["To use it, go to the ",(0,r.jsx)(s.code,{children:"vp_samples/script/04_optical_flow"})," directory, and then directly execute run_optical_flow.sh. The execution method and log output are as follows:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-shell",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"#!/bin/sh"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number"}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"root@j6dvb:/userdata/app/horizon/vp_samples/script/04_optical_flow#"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"sh"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"run_optical_flow.sh"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[I]["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"9150"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"]["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"08"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"-09]["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"15"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:":13:49:256][optical_flow.cpp:289][optical_flow_sample][SAMPLE] frame ["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"] tracking end."})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"..."})}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Description of the results"})}),"\n",(0,r.jsxs)(s.p,{children:["At the end of the sample run, a visualization picture will be generated in the ",(0,r.jsx)(s.code,{children:"vp_samples/script/04_optical_flow"})," directory, and the contents of the generated object for this sample is as follows:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"04_optical_flow"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_1.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_2.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_3.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_4.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_5.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_6.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_7.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_8.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"lkof_9.jpg"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u251C\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"README.md"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"\u2514\u2500\u2500"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"run_optical_flow.sh"})]}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"The first frame will show the results of the harris feature point detection and the subsequent frames will show the optical flow tracking trajectory.\nAmong them, the blue points are the feature points of the previous frame image, the red points are the feature points of the current frame image, and the green color is the optical flow trajectory.\nThe tracking effect of the first and nth frame is shown as belows:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"First Frame"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Frame n"})})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.img,{alt:"image",src:a})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.img,{alt:"image",src:t})})]})})]}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive warning",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"Attention"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"The PyrDown and CornerHarris calculations for this samples are processed on a DSP, so please configure your DSP environment in advance."}),"\n",(0,r.jsx)(s.li,{children:"If you need to replace a picture, please make sure that the replacement input picture is a continuous frame image, otherwise the result of the optical flow calculation may be inaccurate."}),"\n"]})})]})]})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,l.ah)(),e.components);return s?(0,r.jsx)(s,Object.assign({},e,{children:(0,r.jsx)(c,e)})):c(e)}s.default=h,h.__RSPRESS_PAGE_META={},h.__RSPRESS_PAGE_META["3.0.22%2Fen%2Fguide%2Fucp%2Fvp%2Fvp6_sample%2Fop_sample_optical_flow.mdx"]={toc:[],title:"Optical Flow Sample",frontmatter:{}}},95895:function(e,s,n){n(39710);var r=n(85893),l=n(67294),i=n(45687);n(20388);let o={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"\u5C0F\u4E8E 1 \u5206\u949F"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function a(e,s,n){let r=Object.keys(o).includes(s)?s:n;return o[r](e)}s.Z=e=>{let{defaultLocale:s="en-US"}=e,n=(0,i.Vi)().page.readingTimeData,o=(0,i.Jr)(),t=(0,i.e7)(),[c,h]=(0,l.useState)(a(n,o,s));return(0,l.useEffect)(()=>{h(a(n,o,s))},[o,n]),(0,r.jsx)("span",{"data-dark":String(t),className:"rp-reading-time",children:c})}}}]);